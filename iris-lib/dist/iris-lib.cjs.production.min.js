"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("gun"));require("gun/sea"),require("gun/lib/yson"),require("gun/lib/radix"),require("gun/lib/radisk"),require("gun/lib/store"),require("gun/lib/rindexed");var n=e(require("localforage")),r=e(require("fuse.js"));function i(){i=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=Object.create((t&&t.prototype instanceof h?t:h).prototype),a=new A(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return{value:void 0,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=x(s,n);if(o){if(o===p)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function h(){}function f(){}function d(){}var g={};c(g,a,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(E([])));v&&v!==t&&n.call(v,a)&&(g=v);var y=d.prototype=h.prototype=Object.create(g);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var r;this._invoke=function(i,a){function s(){return new t((function(r,s){!function r(i,a,s,o){var c=l(e[i],e,a);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(p).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,o)}))}o(c.arg)}(i,a,r,s)}))}return r=r?r.then(s,s):s()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=d,c(y,"constructor",d),c(d,"constructor",f),f.displayName=c(d,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(w.prototype),c(w.prototype,s,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var s=new w(u(t,n,r,i),a);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),c(y,o,"Generator"),c(y,a,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(o&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}function a(e,t,n,r,i,a,s){try{var o=e[a](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,i)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){a(s,r,i,o,c,"next",e)}function c(e){a(s,r,i,o,c,"throw",e)}o(void 0)}))}}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function l(e,t,n){return(l=u()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&c(i,n.prototype),i}).apply(null,arguments)}function p(e){var t="function"==typeof Map?new Map:void 0;return(p=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return l(e,arguments,o(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)})(e)}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return h(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d=function(e,t){var n;return function(){var r=arguments,i=this;n||(e.apply(i,r),n=!0,setTimeout((function(){return n=!1}),t))}},g=function(e,t){var n;return function(){var r=arguments,i=this;clearTimeout(n),n=setTimeout((function(){return e.apply(i,r)}),t)}},m=function(e){return e[Math.floor(Math.random()*e.length)]},v=function(e,t){var n={};return Object.keys(e).forEach((function(r){t.includes(r)||(n[r]=e[r])})),n},y=!1;try{y="[object process]"===Object.prototype.toString.call(global.process)}catch(e){}var b=!y&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase(),w=b&&b.indexOf(" electron/")>-1,x=["canidae","felidae","cat","cattle","dog","donkey","goat","horse","pig","rabbit","aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","capybara","cardinal","caribou","carp","cat","catshark","caterpillar","catfish","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","cicada","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragonfly","dragon","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","gamefowl","galliform","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","urial","vicuna","viper","vole","vulture","wallaby","walrus","wasp","warbler","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra","alpaca","cat","cattle","chicken","dog","donkey","ferret","gayal","goldfish","guppy","horse","koi","llama","sheep","yak","unicorn"],k=["average","big","colossal","fat","giant","gigantic","great","huge","immense","large","little","long","mammoth","massive","miniature","petite","puny","short","small","tall","tiny","boiling","breezy","broken","bumpy","chilly","cold","cool","creepy","crooked","cuddly","curly","damaged","damp","dirty","dry","dusty","filthy","flaky","fluffy","wet","broad","chubby","crooked","curved","deep","flat","high","hollow","low","narrow","round","shallow","skinny","square","steep","straight","wide","ancient","brief","early","fast","late","long","modern","old","quick","rapid","short","slow","swift","young","abundant","empty","few","heavy","light","many","numerous","Sound","cooing","deafening","faint","harsh","hissing","hushed","husky","loud","melodic","moaning","mute","noisy","purring","quiet","raspy","resonant","screeching","shrill","silent","soft","squealing","thundering","voiceless","whispering","bitter","delicious","fresh","juicy","ripe","rotten","salty","sour","spicy","stale","sticky","strong","sweet","tasteless","tasty","thirsty","fluttering","fuzzy","greasy","grubby","hard","hot","icy","loose","melted","plastic","prickly","rainy","rough","scattered","shaggy","shaky","sharp","shivering","silky","slimy","slippery","smooth","soft","solid","steady","sticky","tender","tight","uneven","weak","wet","wooden","afraid","angry","annoyed","anxious","arrogant","ashamed","awful","bad","bewildered","bored","combative","condemned","confused","creepy","cruel","dangerous","defeated","defiant","depressed","disgusted","disturbed","eerie","embarrassed","envious","evil","fierce","foolish","frantic","frightened","grieving","helpless","homeless","hungry","hurt","ill","jealous","lonely","mysterious","naughty","nervous","obnoxious","outrageous","panicky","repulsive","scary","scornful","selfish","sore","tense","terrible","thoughtless","tired","troubled","upset","uptight","weary","wicked","worried","agreeable","amused","brave","calm","charming","cheerful","comfortable","cooperative","courageous","delightful","determined","eager","elated","enchanting","encouraging","energetic","enthusiastic","excited","exuberant","fair","faithful","fantastic","fine","friendly","funny","gentle","glorious","good","happy","healthy","helpful","hilarious","jolly","joyous","kind","lively","lovely","lucky","obedient","perfect","pleasant","proud","relieved","silly","smiling","splendid","successful","thoughtful","victorious","vivacious","witty","wonderful","zealous","zany","other","good","new","old","great","high","small","different","large","local","social","important","long","young","national","british","right","early","possible","big","little","political","able","late","general","full","far","low","public","available","bad","main","sure","clear","major","economic","only","likely","real","black","particular","international","special","difficult","certain","open","whole","white","free","short","easy","strong","european","central","similar","human","common","necessary","single","personal","hard","private","poor","financial","wide","foreign","simple","recent","concerned","american","various","close","fine","english","wrong","present","royal","natural","individual","nice","french","nihilist","solipsist","materialist","surrealist","heroic","awesome","hedonist","absurd","current","modern","labour","legal","happy","final","red","normal","serious","previous","total","prime","significant","industrial","sorry","dead","specific","appropriate","top","soviet","basic","military","original","successful","aware","hon","popular","heavy","professional","direct","dark","cold","ready","green","useful","effective","western","traditional","scottish","german","independent","deep","interesting","considerable","involved","physical","hot","existing","responsible","complete","medical","blue","extra","past","male","interested","fair","essential","beautiful","civil","primary","obvious","future","environmental","positive","senior","nuclear","annual","relevant","huge","rich","commercial","safe","regional","practical","official","separate","key","chief","regular","due","additional","active","powerful","complex","standard","impossible","light","warm","middle","fresh","sexual","front","domestic","actual","united","technical","ordinary","cheap","strange","internal","excellent","quiet","soft","potential","northern","religious","quick","very","famous","cultural","proper","broad","joint","formal","limited","conservative","lovely","usual","ltd","unable","rural","initial","substantial","bright","average","leading","reasonable","immediate","suitable","equal","detailed","working","overall","female","afraid","democratic","growing","sufficient","scientific","eastern","correct","inc","irish","expensive","educational","mental","dangerous","critical","increased","familiar","unlikely","double","perfect","slow","tiny","dry","historical","thin","daily","southern","increasing","wild","alone","urban","empty","married","narrow","liberal","supposed","upper","apparent","tall","busy","bloody","prepared","russian","moral","careful","clean","attractive","japanese","vital","thick","alternative","fast","ancient","elderly","rare","external","capable","brief","wonderful","grand","typical","entire","grey","constant","vast","surprised","ideal","terrible","academic","funny","minor","pleased","severe","ill","corporate","negative","permanent","weak","brown","fundamental","odd","crucial","inner","used","criminal","contemporary","sharp","sick","near","roman","massive","unique","secondary","parliamentary","african","unknown","subsequent","angry","alive","guilty","lucky","enormous","well","yellow","unusual","net","tough","dear","extensive","glad","remaining","agricultural","alright","healthy","italian","principal","tired","efficient","comfortable","chinese","relative","friendly","conventional","willing","sudden","proposed","voluntary","slight","valuable","dramatic","golden","temporary","federal","keen","flat","silent","indian","worried","pale","statutory","welsh","dependent","firm","wet","competitive","armed","radical","outside","acceptable","sensitive","living","pure","global","emotional","sad","secret","rapid","adequate","fixed","sweet","administrative","wooden","remarkable","comprehensive","surprising","solid","rough","mere","mass","brilliant","maximum","absolute","electronic","visual","electric","cool","spanish","literary","continuing","supreme","chemical","genuine","exciting","written","advanced","extreme","classical","fit","favourite","widespread","confident","straight","proud","numerous","opposite","distinct","mad","helpful","given","disabled","consistent","anxious","nervous","awful","stable","constitutional","satisfied","conscious","developing","strategic","holy","smooth","dominant","remote","theoretical","outstanding","pink","pretty","clinical","minimum","honest","impressive","related","residential","extraordinary","plain","visible","accurate","distant","still","greek","complicated","musical","precise","gentle","broken","live","silly","fat","tight","monetary","round","psychological","violent","unemployed","inevitable","junior","sensible","grateful","pleasant","dirty","structural","welcome","deaf","above","continuous","blind","overseas","mean","entitled","delighted","loose","occasional","evident","desperate","fellow","universal","square","steady","classic","equivalent","intellectual","victorian","level","ultimate","creative","lost","medieval","clever","linguistic","convinced","judicial","raw","sophisticated","asleep","vulnerable","illegal","outer","revolutionary","bitter","changing","australian","native","imperial","strict","wise","informal","flexible","collective","frequent","experimental","spiritual","intense","rational","generous","inadequate","prominent","logical","bare","historic","modest","dutch","acute","electrical","valid","weekly","gross","automatic","loud","reliable","mutual","liable","multiple","ruling","curious","sole","managing","pregnant","latin","nearby","exact","underlying","identical","satisfactory","marginal","distinctive","electoral","urgent","presidential","controversial","everyday","encouraging","organic","continued","expected","statistical","desirable","innocent","improved","exclusive","marked","experienced","unexpected","superb","sheer","disappointed","frightened","gastric","romantic","naked","reluctant","magnificent","convenient","established","closed","uncertain","artificial","diplomatic","tremendous","marine","mechanical","retail","institutional","mixed","required","biological","known","functional","straightforward","superior","digital","spectacular","unhappy","confused","unfair","aggressive","spare","painful","abstract","asian","associated","legislative","monthly","intelligent","hungry","explicit","nasty","just","faint","coloured","ridiculous","amazing","comparable","successive","realistic","back","decent","decentralized","bitcoin","cypherpunk","unnecessary","flying","random","influential","dull","genetic","neat","marvellous","crazy","damp","giant","secure","bottom","skilled","subtle","elegant","brave","lesser","parallel","steep","intensive","casual","tropical","lonely","partial","preliminary","concrete","alleged","assistant","vertical","upset","delicate","mild","occupational","excessive","progressive","exceptional","integrated","striking","continental","okay","harsh","combined","fierce","handsome","characteristic","chronic","compulsory","interim","objective","splendid","magic","systematic","obliged","payable","fun","horrible","primitive","fascinating","ideological","metropolitan","surrounding","estimated","peaceful","premier","operational","technological","kind","advisory","hostile","precious","accessible","determined","excited","impressed","provincial","smart","endless","isolated","drunk","geographical","like","dynamic","boring","forthcoming","unfortunate","definite","super","notable","indirect","stiff","wealthy","awkward","lively","neutral","artistic","content","mature","colonial","ambitious","evil","magnetic","verbal","legitimate","sympathetic","empirical","head","shallow","vague","naval","depressed","shared","added","shocked","mid","worthwhile","qualified","missing","blank","absent","favourable","polish","israeli","developed","profound","representative","enthusiastic","dreadful","rigid","reduced","cruel","coastal","peculiar","swiss","crude","extended","selected","eager","canadian","bold","relaxed","corresponding","running","planned","applicable","immense","allied","comparative","uncomfortable","conservation","productive","beneficial","bored","charming","minimal","mobile","turkish","orange","rear","passive","suspicious","overwhelming","fatal","resulting","symbolic","registered","neighbouring","calm","irrelevant","patient","compact","profitable","rival","loyal","moderate","distinguished","interior","noble","insufficient","eligible","mysterious","varying","managerial","molecular","olympic","linear","prospective","printed","parental","diverse","elaborate","furious","fiscal","burning","useless","semantic","embarrassed","inherent","philosophical","deliberate","awake","variable","promising","unpleasant","varied","sacred","selective","inclined","tender","hidden","worthy","intermediate","sound","protective","fortunate","slim","defensive","divine","stuck","driving","invisible","misleading","circular","mathematical","inappropriate","liquid","persistent","solar","doubtful","manual","architectural","intact","incredible","devoted","prior","tragic","respectable","optimistic","convincing","unacceptable","decisive","competent","spatial","respective","binding","relieved","nursing","toxic","select","redundant","integral","then","probable","amateur","fond","passing","specified","territorial","horizontal","inland","cognitive","regulatory","miserable","resident","polite","scared","gothic","civilian","instant","lengthy","adverse","korean","unconscious","anonymous","aesthetic","orthodox","static","unaware","costly","fantastic","foolish","fashionable","causal","compatible","wee","implicit","dual","ok","cheerful","subjective","forward","surviving","exotic","purple","cautious","visiting","aggregate","ethical","teenage","dying","disastrous","delicious","confidential","underground","thorough","grim","autonomous","atomic","frozen","colourful","injured","uniform","ashamed","glorious","wicked","coherent","rising","shy","novel","balanced","delightful","arbitrary","adjacent","worrying","weird","unchanged","rolling","evolutionary","intimate","sporting","disciplinary","formidable","lexical","noisy","gradual","accused","homeless","supporting","coming","renewed","excess","retired","rubber","chosen","outdoor","embarrassing","preferred","bizarre","appalling","agreed","imaginative","governing","accepted","vocational","mighty","puzzled","worldwide","organisational","sunny","eldest","eventual","spontaneous","vivid","rude","faithful","ministerial","innovative","controlled","conceptual","unwilling","civic","meaningful","alive","brainy","breakable","busy","careful","cautious","clever","concerned","crazy","curious","dead","different","difficult","doubtful","easy","famous","fragile","helpful","helpless","important","impossible","innocent","inquisitive","modern","open","outstanding","poor","powerful","puzzled","real","rich","shy","sleepy","super","tame","uninterested","wandering","wild","wrong","adorable","alert","average","beautiful","blonde","bloody","blushing","bright","clean","clear","cloudy","colorful","crowded","cute","dark","drab","distinct","dull","elegant","fancy","filthy","glamorous","gleaming","graceful","grotesque","homely","light","misty","motionless","muddy","plain","poised","quaint","shiny","smoggy","sparkling","spotless","stormy","strange","ugly","unsightly","unusual","bad","better","beautiful","big","black","blue","bright","clumsy","crazy","dizzy","dull","fat","frail","friendly","funny","great","green","gigantic","gorgeous","grumpy","handsome","happy","horrible","itchy","jittery","jolly","kind","long","lazy","magnificent","magenta","many","mighty","mushy","nasty","new","nice","nosy","nutty","nutritious","odd","orange","ordinary","pretty","precious","prickly","purple","quaint","quiet","quick","quickest","rainy","rare","ratty","red","roasted","robust","round","sad","scary","scrawny","short","silly","stingy","strange","striped","spotty","tart","tall","tame","tan","tender","testy","tricky","tough","ugly","ugliest","vast","watery","wasteful","wonderful","yellow","yummy","zany"],S={gunOnceDefined:function(e){return new Promise((function(t){e.on((function(e,n,r,i){void 0!==e&&(i.off(),t(e))}))}))},gunAsAnotherUser:function(e,n,r){var i=new t({radisk:!1,peers:Object.keys(e._.opt.peers)}),a=i.user();return a.auth(n),setTimeout((function(){Object.values(i.back("opt.peers")).forEach((function(e){i.on("bye",e)}))}),2e4),r(a)},getHash:function(e,n){var r=this;return s(i().mark((function a(){var s;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0===n&&(n="base64"),e){i.next=3;break}return i.abrupt("return",void 0);case 3:return i.next=5,t.SEA.work(e,void 0,void 0,{name:"SHA-256"});case 5:if(s=i.sent){i.next=8;break}throw new Error("Gun.SEA.work failed for "+e);case 8:if(!(s.length>44)){i.next=10;break}throw new Error("Gun.SEA.work returned an invalid SHA-256 hash longer than 44 chars: "+s+". This is probably due to a sea.js bug on Safari.");case 10:if("hex"!==n){i.next=12;break}return i.abrupt("return",r.base64ToHex(s));case 12:return i.abrupt("return",s);case 13:case"end":return i.stop()}}),a)})))()},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},generateName:function(){return this.capitalize(m(k))+" "+this.capitalize(m(x))},base64ToHex:function(e){for(var t=atob(e),n="",r=0;r<t.length;r++){var i=t.charCodeAt(r).toString(16);n+=2===i.length?i:"0"+i}return n},getCaret:function(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null===t)return 0;var n=e.createTextRange(),r=n.duplicate();return n.moveToBookmark(t.getBookmark()),r.setEndPoint("EndToStart",n),r.text.length}return 0},injectCss:function(){if(!document.getElementById("irisStyle")){var e=document.createElement("style");e.id="irisStyle",e.innerHTML='\n      .iris-follow-button .hover {\n        display: none;\n      }\n\n      .iris-follow-button.following:hover .hover {\n        display: inline;\n      }\n\n      .iris-follow-button.following:hover .nonhover {\n        display: none;\n      }\n\n      .iris-identicon * {\n        box-sizing: border-box;\n      }\n\n      .iris-identicon {\n        vertical-align: middle;\n        border-radius: 50%;\n        text-align: center;\n        display: inline-block;\n        position: relative;\n        max-width: 100%;\n      }\n\n      .iris-distance {\n        z-index: 2;\n        position: absolute;\n        left:0%;\n        top:2px;\n        width: 100%;\n        text-align: right;\n        color: #fff;\n        text-shadow: 0 0 1px #000;\n        font-size: 75%;\n        line-height: 75%;\n        font-weight: bold;\n      }\n\n      .iris-pie {\n        border-radius: 50%;\n        position: absolute;\n        top: 0;\n        left: 0;\n        box-shadow: 0px 0px 0px 0px #82FF84;\n        padding-bottom: 100%;\n        max-width: 100%;\n        -webkit-transition: all 0.2s ease-in-out;\n        -moz-transition: all 0.2s ease-in-out;\n        transition: all 0.2s ease-in-out;\n      }\n\n      .iris-card {\n        padding: 10px;\n        background-color: #f7f7f7;\n        color: #777;\n        border: 1px solid #ddd;\n        display: flex;\n        flex-direction: row;\n        overflow: hidden;\n      }\n\n      .iris-card a {\n        -webkit-transition: color 150ms;\n        transition: color 150ms;\n        text-decoration: none;\n        color: #337ab7;\n      }\n\n      .iris-card a:hover, .iris-card a:active {\n        text-decoration: underline;\n        color: #23527c;\n      }\n\n      .iris-pos {\n        color: #3c763d;\n      }\n\n      .iris-neg {\n        color: #a94442;\n      }\n\n      .iris-identicon img {\n        position: absolute;\n        top: 0;\n        left: 0;\n        max-width: 100%;\n        border-radius: 50%;\n        border-color: transparent;\n        border-style: solid;\n      }\n\n      .iris-chat-open-button {\n        background-color: #1e1e1e;\n        color: #fff;\n        padding: 15px;\n        cursor: pointer;\n        user-select: none;\n      }\n\n      .iris-chat-open-button svg {\n        width: 1em;\n      }\n\n      .iris-chat-open-button, .iris-chat-box {\n        position: fixed;\n        bottom: 0.5rem;\n        right: 0.5rem;\n        border-radius: 8px;\n        font-family: system-ui;\n        font-size: 15px;\n      }\n\n      .iris-chat-box {\n        background-color: #fff;\n        max-height: 25rem;\n        box-shadow: 2px 2px 20px rgba(0, 0, 0, 0.2);\n        height: calc(100% - 44px);\n        display: flex;\n        flex-direction: column;\n        width: 320px;\n        color: rgb(38, 38, 38);\n      }\n\n      .iris-chat-box.minimized {\n        height: auto;\n      }\n\n      .iris-chat-box.minimized .iris-chat-header {\n        border-radius: 8px;\n        cursor: pointer;\n      }\n\n      .iris-chat-box.minimized .iris-chat-messages, .iris-chat-box.minimized .iris-typing-indicator, .iris-chat-box.minimized .iris-chat-input-wrapper, .iris-chat-box.minimized .iris-chat-minimize, .iris-chat-box.minimized .iris-chat-close {\n        display: none;\n      }\n\n      .iris-chat-header {\n        background-color: #1e1e1e;\n        height: 44px;\n        color: #fff;\n        border-radius: 8px 8px 0 0;\n        text-align: center;\n        display: flex;\n        flex-direction: row;\n        justify-content: center;\n        align-items: center;\n        flex: none;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        overflow: hidden;\n      }\n\n      .iris-chat-header-text {\n        flex: 1;\n      }\n\n      .iris-online-indicator {\n        color: #bfbfbf;\n        margin-right: 5px;\n        font-size: 12px;\n        user-select: none;\n        flex: none;\n      }\n\n      .iris-online-indicator.yes {\n        color: #80bf5f;\n      }\n\n      .iris-typing-indicator {\n        display: none;\n        background-color: rgba(255, 255, 255, 0.5);\n        font-size: 12px;\n        padding: 2px;\n        color: #777;\n      }\n\n      .iris-typing-indicator.yes {\n        display: block;\n      }\n\n      .iris-chat-messages {\n        flex: 1;\n        padding: 15px;\n        overflow-y: scroll;\n      }\n\n      .iris-chat-input-wrapper {\n        flex: none;\n        padding: 15px;\n        background-color: #efefef;\n        display: flex;\n        flex-direction: row;\n        border-radius: 0 0 8px 8px;\n      }\n\n      .iris-chat-input-wrapper textarea {\n        padding: 15px 8px;\n        border-radius: 4px;\n        border: 1px solid rgba(0,0,0,0);\n        width: auto;\n        font-size: 15px;\n        resize: none;\n        flex: 1;\n      }\n\n      .iris-chat-input-wrapper textarea:focus {\n        outline: none;\n        border: 1px solid #6dd0ed;\n      }\n\n      .iris-chat-input-wrapper button svg {\n        display: inline-block;\n        font-size: inherit;\n        height: 1em;\n        width: 1em;\n        overflow: visible;\n        vertical-align: -0.125em;\n      }\n\n      .iris-chat-input-wrapper button, .iris-chat-input-wrapper button:hover, .iris-chat-input-wrapper button:active, .iris-chat-input-wrapper button:focus {\n        flex: none;\n        color: #999;\n        background-color: transparent;\n        font-size: 30px;\n        padding: 5px;\n        border: 1px solid rgba(0,0,0,0);\n        border-radius: 4px;\n        margin-left: 5px;\n      }\n\n      .iris-chat-input-wrapper button:active, .iris-chat-input-wrapper button:focus {\n        outline: none;\n        border: 1px solid #6dd0ed;\n      }\n\n      .iris-chat-message {\n        display: flex;\n        flex-direction: column;\n        margin-bottom: 2px;\n        overflow-wrap: break-word;\n      }\n\n      .iris-msg-content {\n        background-color: #efefef;\n        padding: 6px 10px;\n        border-radius: 8px;\n        box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.1);\n        flex: none;\n        max-width: 75%;\n      }\n\n      .emoji {\n        font-size: 1.3em;\n        line-height: 1em;\n      }\n\n      .iris-chat-message .emoji-only {\n        font-size: 3em;\n        text-align: center;\n      }\n\n      .iris-seen {\n        color: rgba(0, 0, 0, 0.45);\n        user-select: none;\n      }\n\n      .iris-seen.yes {\n        color: #4fc3f7;\n      }\n\n      .iris-seen svg {\n        width: 18px;\n      }\n\n      .iris-delivered-checkmark {\n        display: none;\n      }\n\n      .delivered .iris-delivered-checkmark {\n        display: initial;\n      }\n\n      .iris-chat-minimize, .iris-chat-close {\n        user-select: none;\n        cursor: pointer;\n        width: 45px;\n        line-height: 44px;\n      }\n\n      .iris-chat-message.their {\n        align-items: flex-start;\n      }\n\n      .iris-chat-message.their + .iris-chat-message.our .iris-msg-content, .day-separator + .iris-chat-message.our .iris-msg-content {\n        margin-top: 15px;\n        border-radius: 8px 0px 8px 8px;\n      }\n\n      .iris-chat-message.their:first-of-type .iris-msg-content {\n        border-radius: 0px 8px 8px 8px;\n      }\n\n      .iris-chat-message.our:first-of-type .iris-msg-content {\n        border-radius: 8px 0px 8px 8px;\n      }\n\n      .iris-chat-message.our + .iris-chat-message.their .iris-msg-content, .day-separator + .iris-chat-message.their .iris-msg-content {\n        margin-top: 15px;\n        border-radius: 0px 8px 8px 8px;\n      }\n\n      .iris-chat-message.our {\n        align-items: flex-end;\n      }\n\n      .iris-chat-message.our .iris-msg-content {\n        background-color: #c5ecf7;\n      }\n\n      .iris-chat-message .time {\n        text-align: right;\n        font-size: 12px;\n        color: rgba(0, 0, 0, 0.45);\n      }\n\n      .iris-non-string {\n        color: blue;\n      }\n\n      .day-separator {\n        display: inline-block;\n        border-radius: 8px;\n        background-color: rgba(227, 249, 255, 0.91);\n        padding: 6px 10px;\n        margin-top: 15px;\n        margin-left: auto;\n        margin-right: auto;\n        text-transform: uppercase;\n        font-size: 13px;\n        color: rgba(74, 74, 74, 0.88);\n        box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.1);\n        user-select: none;\n      }\n\n      .day-separator:first-of-type {\n        margin-top: 0;\n      }\n\n      *[contenteditable="true"]:not(:focus) {\n        cursor: pointer;\n      }\n\n      *[contenteditable="true"] {\n        outline: none;\n      }\n\n      [placeholder]:empty:before {\n        content: attr(placeholder);\n        color: #999;\n      }\n\n      [placeholder]:empty:focus {\n        cursor: text;\n      }\n      ',document.head.prepend(e)}},getUrlParameter:function(e,t){var n,r,i=(t||window.location.search.substring(1)).split("&");for(r=0;r<i.length;r++)if((n=i[r].split("="))[0]===e)return void 0===n[1]||decodeURIComponent(n[1])},formatTime:function(e){var t=e.toLocaleTimeString(void 0,{timeStyle:"short"}),n=t.split(":");return 3===n.length?n[0]+":"+n[1]+n[2].slice(2):t},formatDate:function(e){var t=e.toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"}),n=t.split(":");return 3===n.length?n[0]+":"+n[1]+n[2].slice(2):t},getDaySeparatorText:function(e,t,n,r){if(n||(r=(n=new Date).toLocaleDateString({dateStyle:"short"})),t===r)return"today";var i=Math.round((n-e)/864e5);return 0===i?"today":1===i?"yesterday":i<=5?e.toLocaleDateString(void 0,{weekday:"long"}):t},getProfileLink:function(e){return window.location.origin+"/#/profile/"+encodeURIComponent(e)},truncateString:function(e,t){return void 0===t&&(t=30),e.length>t?e.slice(0,t)+"...":e},createElement:function(e,t,n){var r=document.createElement(e);return t&&r.setAttribute("class",t),n&&n.appendChild(r),r},isNode:y,isElectron:w,isMobile:!y&&function(){if(w)return!1;var e,t=!1;return e=navigator.userAgent||navigator.vendor||"",(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}(),throttle:function(e,t){var n;return function(){var r=arguments,i=this;n||(e.apply(i,r),n=!0,setTimeout((function(){return n=!1}),t))}},debounce:function(e,t){var n;return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout((function(){return e.apply(r,i)}),t)}},sample:function(e){return e[Math.floor(Math.random()*e.length)]},sampleSize:function(e,t){for(var n,r,i=e.slice(0),a=e.length,s=a-t;a-- >s;)n=i[r=Math.floor((a+1)*Math.random())],i[r]=i[a],i[a]=n;return i.slice(s)},defer:function(e){return setTimeout(e,0)},once:function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}},omit:function(e,t){var n={};return Object.keys(e).forEach((function(r){t.includes(r)||(n[r]=e[r])})),n}},A="http://localhost:8767/gun",E={"https://gun-rs.iris.to/gun":{},"https://gun-us.herokuapp.com/gun":{}},T=window.location,O=T.host,M=O.startsWith("localhost")&&"localhost:8080"!==O;(T.hostname.endsWith("herokuapp.com")||M)&&(Object.keys(E).forEach((function(e){return E[e].enabled=!1})),E[T.origin+"/gun"]={enabled:!0});var L,I=/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\/?$/,C={known:{},add:function(e){var n=this;return s(i().mark((function r(){var a,s,o,c;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.url||I.test(e.url)){r.next=2;break}throw new Error("Invalid url "+e.url);case 2:if(e.from&&Object.keys(n.known).forEach((function(t){n.known[t].from===e.from&&delete n.known[t]})),n.known[a=e.url||""]=n.known[a]||v(e,["url"]),"public"!==e.visibility){r.next=19;break}return r.next=8,t.SEA.secret(De.getKey().epub,De.getKey());case 8:if(r.t0=r.sent,r.t0){r.next=11;break}r.t0="";case 11:return s=r.t0,r.next=14,t.SEA.encrypt(e.url,s);case 14:return o=r.sent,r.next=17,t.SEA.work(o,null,null,{name:"SHA-256"});case 17:c=r.sent,j().user().get("peers").get(c).put({url:e.url,lastSeen:(new Date).toISOString()});case 19:!1!==e.enabled?e.url&&n.connect(e.url):n.save();case 20:case"end":return r.stop()}}),r)})))()},remove:function(e){delete this.known[e],this.save()},disconnect:function(e){j().on("bye",e),e.url=""},save:function(){localStorage.setItem("gunPeers",JSON.stringify(this.known))},getSaved:function(){var e=localStorage.getItem("gunPeers");return e=e&&"undefined"!==e?JSON.parse(e):E,S.isElectron&&(e[A]={}),Object.keys(e).forEach((function(t){return n=e[t],r={enabled:!0},Object.keys(r).forEach((function(e){void 0===n[e]&&(n[e]=r[e])})),n;var n,r})),e},reset:function(){localStorage.setItem("gunPeers",""),this.known=this.getSaved()},connect:function(e){this.isMixedContent(e)||(this.known[e]?(this.known[e].enabled=!0,j().opt({peers:[e]}),this.save()):this.add({url:e}))},disable:function(e,t){this.known[e].enabled=!1,t&&this.disconnect(t),this.save()},isMixedContent:function(e){return"https:"===window.location.protocol&&0===e.indexOf("http:")},random:function(){var e,t,n,r=this,i=S.isElectron&&this.known[A]&&!1!==this.known[A].enabled,a=i?Math.max(0,1):1,s=function(e,t){for(var n,r,i=e.slice(0),a=e.length,s=a-t;a-- >s;)n=i[r=Math.floor((a+1)*Math.random())],i[r]=i[a],i[a]=n;return i.slice(s)}(Object.keys((e=this.known,t=function(e,t){return!r.isMixedContent(t)&&e.enabled&&!(S.isElectron&&t===A)},n={},Object.keys(e).forEach((function(r){t(e[r])&&(n[r]=e[r])})),n)),a);return s&&i&&s.push(A),s},checkGunPeerCount:function(){var e=this,t=j().back("opt.peers"),n=Object.values(t).filter((function(e){return e&&e.wire&&"WebSocket"!==e.wire.constructor.name&&console.log("WebRTC peer",e),e&&e.wire&&1===e.wire.readyState&&0===e.wire.bufferedAmount&&"WebSocket"===e.wire.constructor.name}));if(n.length<1){var r=Object.keys(this.known).filter((function(n){var r=Object.values(t).map((function(e){return e.url})).indexOf(n)>-1,i=e.known[n].enabled;return!("https:"===window.location.protocol&&0===n.indexOf("http:"))&&i&&!r}));if(r.length){var i=String(m(r));this.connect(i)}}n.length>1&&this.disconnect(m(n))},init:function(){var e=this;this.known=this.getSaved(),setInterval((function(){return e.checkGunPeerCount()}),1e3)}};function j(e){if(void 0===e&&(e={}),!L){var n=Object.assign({peers:e.peers||C.random(),localStorage:!1,retry:Infinity},e);e.peers&&e.peers.forEach((function(e){return C.add({url:e})})),C.init(),L=new t(n)}return L}var D,P={email:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,bitcoin:/^[13][a-km-zA-HJ-NP-Z0-9]{26,33}$/,bitcoin_address:/^[13][a-km-zA-HJ-NP-Z0-9]{26,33}$/,ip:/^(([1-9]?\d|1\d\d|2[0-5][0-5]|2[0-4]\d)\.){3}([1-9]?\d|1\d\d|2[0-5][0-5]|2[0-4]\d)$/,ipv6:/^(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}$/,gpg_fingerprint:null,gpg_keyid:null,google_oauth2:null,tel:/^\d{7,}$/,phone:/^\d{7,}$/,keyID:null,url:/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,account:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,uuid:/[0-9a-f]{8}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{12}/},z=function(){function e(t,n){if("object"==typeof t){if("string"!=typeof t.value)throw new Error("param1.value must be a string, got "+typeof t.value+": "+JSON.stringify(t.value));if("string"!=typeof t.type)throw new Error("param1.type must be a string, got "+typeof t.type+": "+JSON.stringify(t.type));n=t.value,t=t.type}if("string"!=typeof t)throw new Error("First param must be a string, got "+typeof t+": "+JSON.stringify(t));if(!t.length)throw new Error("First param string is empty");if(n){if("string"!=typeof n)throw new Error("Second parameter must be a string, got "+typeof n+": "+JSON.stringify(n));if(!n.length)throw new Error("Second param string is empty");this.type=t,this.value=n}else{this.value=t;var r=e.guessTypeOf(this.value);if(!r)throw new Error("Type of attribute was omitted and could not be guessed");this.type=r}}e.getUuid=function(){return new e("uuid",function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}())},e.getUniqueIdValidators=function(){return P},e.isUniqueType=function(e){return Object.keys(P).indexOf(e)>-1};var t=e.prototype;return t.isUniqueType=function(){return e.isUniqueType(this.type)},e.guessTypeOf=function(e){for(var t in P)if(e.match(P[t]))return t},e.equals=function(e,t){return e.equals(t)},t.equals=function(e){return e&&this.type===e.type&&this.value===e.value},t.uri=function(){return encodeURIComponent(this.value)+":"+encodeURIComponent(this.type)},e}();function K(e){return D||(D=j().user()).auth(De.getKey()),e?j().user(e):D}var _={read:!0,write:!0,admin:!1},N=function(){function e(e){var t=this;if(this.theirSecretUuids={},this.theirGroupSecrets={},this.secrets={},this.ourSecretChannelIds={},this.theirSecretChannelIds={},this.messages={},this.chatLinks={},this.groupSubscriptions={},this.directSubscriptions={},this.getParticipantsCallbacks={},this.myGroupSecret=e.myGroupSecret,e.chatLink&&this.useChatLink(e),"string"==typeof e.participants)this.addParticipant(e.participants,e.save);else if(Array.isArray(e.participants)){var n={};e.participants.forEach((function(e){return n[e]=Object.assign({},_)})),e.participants=n}"object"==typeof e.participants&&(Object.keys(e.participants).forEach((function(n){n!==De.getKey().pub&&t.addParticipant(n,e.save,Object.assign({},_,e.participants[n]))})),e.participants[De.getKey().pub]=e.participants[De.getKey().pub]||Object.assign({},_),e.uuid?(this.uuid=e.uuid,this.name=e.name):(e.uuid=z.getUuid().value,this.uuid=e.uuid,e.participants[De.getKey().pub].admin=!0,e.participants[De.getKey().pub].founder=!0),this.getChatLinks({subscribe:!0})),this.participants=e.participants,e.uuid&&(this.putDirect("S"+this.uuid,this.getMyGroupSecret()),this.getMySecretUuid().then((function(e){t.putDirect(t.uuid,e)})),this.onTheirDirect(this.uuid,(function(e,n,r){t.theirSecretUuids[r]=e})),this.onTheirDirect("S"+this.uuid,(function(e,n,r){t.theirGroupSecrets[r]=e}))),this.onTheir("participants",(function(n,r,i){for(var a=!1,s=Object.keys(t.participants),o=0;o<s.length;o++)if(t.participants[s[o]].admin||t.participants[s[o]].inviter){a=!0;break}if(a||s.forEach((function(e){return t.participants[e].admin=!0})),t.participants[i]&&(t.participants[i].admin||t.participants[i].inviter)&&"object"==typeof n){if(JSON.stringify(t.participants)===JSON.stringify(n))return;t.participants=n,delete t.participants[i].inviter,Object.keys(n).forEach((function(e){e!==De.getKey().pub&&t.addParticipant(e,!0,Object.assign({},_,n[e]),!0)})),t.participantsChanged(),e.saved=!0}})),e.saved||void 0!==e.save&&!0!==e.save||this.save()}var n=e.prototype;return n.useChatLink=function(e){var n=e.chatLink.split("?");if(2===n.length){var r=S.getUrlParameter("chatWith",n[1]),a=S.getUrlParameter("channelId",n[1]),o=S.getUrlParameter("inviter",n[1]),c=o||r;if(r?e.participants=c:a&&o&&o!==De.getKey().pub&&(e.uuid=a,e.participants={},e.participants[o]=Object.assign({inviter:!0},_)),c!==De.getKey().pub){var u=S.getUrlParameter("s",n[1]),l=S.getUrlParameter("k",n[1]);u&&l&&(this.save(),e.saved=!0,j().user(c).get("chatLinks").get(l).get("encryptedSharedKey").on(function(){var e=s(i().mark((function e(n){var r,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.SEA.decrypt(n,u);case 2:return r=e.sent,e.next=5,t.SEA.encrypt(De.getKey().pub,u);case 5:return a=e.sent,e.next=8,S.getHash(a);case 8:s=e.sent,S.gunAsAnotherUser(j(),r,(function(e){e.get("chatRequests").get(s.slice(0,12)).put(a)}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}}},n.getTheirSecretUuid=function(e){var t=this;return new Promise((function(n){t.theirSecretUuids[e]?n(t.theirSecretUuids[e]):t.onTheirDirect(t.uuid,(function(r){t.theirSecretUuids[e]=r,n(t.theirSecretUuids[e])}),e)}))},n.getTheirGroupSecret=function(e){var t=this;return e===De.getKey().pub?this.getMyGroupSecret():new Promise((function(n){t.theirGroupSecrets[e]?n(t.theirGroupSecrets[e]):t.onTheirDirect("S"+t.uuid,(function(r){t.theirGroupSecrets[e]=r,n(t.theirGroupSecrets[e])}),e)}))},n.changeMyGroupSecret=function(){this.myGroupSecret=t.SEA.random(32).toString("base64"),this.putDirect("S"+this.uuid,this.myGroupSecret)},n.mute=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j().user(t).get(this.theirSecretUuids[t]).off();case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.block=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mute(t),this.putDirect(this.uuid,null),this.putDirect("S"+this.uuid,null),delete this.secrets[t],delete this.ourSecretChannelIds[t],delete this.theirSecretChannelIds[t],this.changeMyGroupSecret();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getMySecretUuid=function(){var e=s(i().mark((function e(){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mySecretUuid){e.next=10;break}return e.next=3,t.SEA.secret(De.getKey().epub,De.getKey());case 3:return n=e.sent,e.next=6,S.getHash(n);case 6:return r=e.sent,e.next=9,S.getHash(r+this.uuid);case 9:this.mySecretUuid=e.sent;case 10:return e.abrupt("return",this.mySecretUuid);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getCurrentParticipants=function(){return Object.keys(this.secrets)},n.getParticipants=function(e){this.getParticipantsCallbackId?this.getParticipantsCallbackId++:this.getParticipantsCallbackId=1,this.getParticipantsCallbacks[this.getParticipantsCallbackId]=e,this.participants&&e(this.participants)},n.participantsChanged=function(){var e=this;Object.keys(this.getParticipantsCallbacks).forEach((function(t){e.getParticipantsCallbacks[t](e.participants)}))},n.getId=function(){return this.uuid||this.getCurrentParticipants()[0]},n.getSecret=function(){var e=s(i().mark((function e(n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.secrets[n]){e.next=7;break}return e.next=3,S.gunOnceDefined(j().user(n).get("epub"));case 3:return r=e.sent,e.next=6,t.SEA.secret(r,De.getKey());case 6:this.secrets[n]=e.sent;case 7:return e.abrupt("return",this.secrets[n]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.getOurSecretChannelId=function(){var e=s(i().mark((function e(n,r){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.gunOnceDefined(j().user(n).get("epub"));case 2:return a=e.sent,e.next=5,t.SEA.secret(a,r);case 5:return e.abrupt("return",S.getHash(e.sent+n));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.getTheirSecretChannelId=function(){var e=s(i().mark((function e(n,r){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.gunOnceDefined(j().user(n).get("epub"));case 2:return a=e.sent,e.next=5,t.SEA.secret(a,r);case 5:return e.abrupt("return",S.getHash(e.sent+r.pub));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.getChannels=function(){var n=s(i().mark((function n(r,a){var o,c,u,l;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===a&&(a=!0),o=De.getKey(),n.next=4,t.SEA.secret(o.epub,o);case 4:c=n.sent,a&&e.getMyChatLinks(void 0,void 0,!0),u={},l=function(){var n=s(i().mark((function n(a,s){var l,p;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!a||u[s]){n.next=14;break}if(u[s]=!0,!(s.length>44)){n.next=5;break}return j().user().get("chats").get(s).put(null),n.abrupt("return");case 5:return n.next=7,S.gunOnceDefined(j().user().get("chats").get(s).get("pub"));case 7:return l=n.sent,n.next=10,t.SEA.decrypt(l,c);case 10:if(p=n.sent){n.next=13;break}return n.abrupt("return");case 13:p.pub||"string"==typeof p?r(new e({key:o,participants:p.pub||p,save:!1})):p.uuid&&p.participants&&p.myGroupSecret&&r(new e({key:o,participants:p.participants,uuid:p.uuid,myGroupSecret:p.myGroupSecret,save:!1}));case 14:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),j().user().get("chats").map().on(l);case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),n.getMyGroupSecret=function(){return this.myGroupSecret||this.changeMyGroupSecret(),this.myGroupSecret},n.getOurSecretChannelId=function(){var e=s(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ourSecretChannelIds[t]){e.next=7;break}return e.next=3,this.getSecret(t);case 3:return n=e.sent,e.next=6,S.getHash(n+t);case 6:this.ourSecretChannelIds[t]=e.sent;case 7:return e.abrupt("return",this.ourSecretChannelIds[t]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getTheirSecretChannelId=function(){var e=s(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.theirSecretChannelIds[t]){e.next=7;break}return e.next=3,this.getSecret(t);case 3:return n=e.sent,e.next=6,S.getHash(n+De.getKey().pub);case 6:this.theirSecretChannelIds[t]=e.sent;case 7:return e.abrupt("return",this.theirSecretChannelIds[t]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getMessages=function(){var e=s(i().mark((function e(t){var n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getCurrentParticipants().forEach(function(){var e=s(i().mark((function e(n){var a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n===De.getKey().pub){e.next=11;break}if(!r.uuid){e.next=7;break}return e.next=4,r.getTheirSecretUuid(n);case 4:a=e.sent,e.next=10;break;case 7:return e.next=9,r.getTheirSecretChannelId(n);case 9:a=e.sent;case 10:j().user(n).get("chats").get(a).get("msgs").map().once((function(e,i){r.messageReceived(t,e,r.uuid||n,!1,i,n)}));case 11:if(r.uuid){e.next=16;break}return e.next=14,r.getOurSecretChannelId(n);case 14:s=e.sent,K().get("chats").get(s).get("msgs").map().once((function(e,i){r.messageReceived(t,e,n,!0,i,De.getKey().pub)}));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),!this.uuid){e.next=6;break}return e.next=4,this.getMySecretUuid();case 4:n=e.sent,K().get("chats").get(n).get("msgs").map().once((function(e,n){r.messageReceived(t,e,r.uuid,!0,n,De.getKey().pub)}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.messageReceived=function(){var e=s(i().mark((function e(n,r,a,s,o,c){var u,l,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messages[o]&&r){e.next=2;break}return e.abrupt("return");case 2:if(!this.uuid){e.next=8;break}return e.next=5,this.getTheirGroupSecret(c);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,this.getSecret(a);case 10:e.t0=e.sent;case 11:return u=e.t0,e.next=14,t.SEA.decrypt(r,u);case 14:if("object"==typeof(l=e.sent)){e.next=17;break}return e.abrupt("return");case 17:p={selfAuthored:s,channelId:a,from:c},this.messages[o]=l,n(l,p);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}(),n.getLatestMsg=function(){var e=s(i().mark((function e(t){var n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=function(){var e=s(i().mark((function e(n,a){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.latest?("string"==typeof r.latest.time?r.latest.time:r.latest.time.toISOString())<n.time&&(r.latest=n,t(n,a)):(r.latest=n,t(n,a));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.onMy("latestMsg",(function(e){return n(e,{selfAuthored:!0,from:De.getKey().pub})})),this.onTheir("latestMsg",(function(e,t,r){return n(e,{selfAuthored:!1,from:r})}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setMyMsgsLastSeenTime=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||(new Date).toISOString(),e.abrupt("return",this.put("msgsLastSeenTime",t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getMyMsgsLastSeenTime=function(){var e=s(i().mark((function e(t){var n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.onMy("msgsLastSeenTime",(function(e){n.myMsgsLastSeenTime=e,t&&t(n.myMsgsLastSeenTime)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getTheirMsgsLastSeenTime=function(){var e=s(i().mark((function e(t){var n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.onTheir("msgsLastSeenTime",(function(e){n.theirMsgsLastSeenTime=e,t&&t(n.theirMsgsLastSeenTime)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.removeParticipant=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.addParticipant(t,!0,{read:!1,write:!1});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.addParticipant=function(){var e=s(i().mark((function e(n,r,a,s){var o,c,u=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=!0),!this.uuid){e.next=3;break}return e.abrupt("return");case 3:if(void 0===a&&(a=_),!this.secrets[n]||JSON.stringify(this.secrets[n])!==JSON.stringify(a)){e.next=6;break}return e.abrupt("return");case 6:return this.secrets[n]=null,this.getSecret(n),e.next=10,this.getOurSecretChannelId(n);case 10:if(o=e.sent,!r){e.next=20;break}return e.next=14,t.SEA.secret(De.getKey().epub,De.getKey());case 14:return c=e.sent,e.t0=j().user().get("chats").get(o).get("pub"),e.next=18,t.SEA.encrypt({pub:n},c);case 18:e.t1=e.sent,e.t0.put.call(e.t0,e.t1);case 20:this.uuid&&(this.participants[n]=a,r&&(this.putDirect("S"+this.uuid,this.getMyGroupSecret()),this.getMySecretUuid().then((function(e){u.putDirect(u.uuid,e)})),this.onTheirDirect(this.uuid,(function(e,t,n){u.theirSecretUuids[n]=e})),this.onTheirDirect("S"+this.uuid,(function(e,t,n){u.theirGroupSecrets[n]=e})),this.save())),s&&(Object.values(this.directSubscriptions).forEach((function(e){e.forEach((function(e){e.from&&e.from!==n||u._onTheirDirectFromUser(n,e.key,e.callback)}))})),Object.values(this.groupSubscriptions).forEach((function(e){e.forEach((function(e){e.from&&e.from!==n||(a.write?u._onTheirGroupFromUser(n,e.key,e.callback):e.event&&e.event.off())}))})));case 22:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.send=function(){var e=s(i().mark((function e(n){var r,a,s,o,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof n){e.next=7;break}if(0!==(n=n.trim()).length){e.next=4;break}return e.abrupt("return");case 4:n={time:(new Date).toISOString(),text:n},e.next=12;break;case 7:if("object"!=typeof n){e.next=11;break}n.time=n.time||(new Date).toISOString(),e.next=12;break;case 11:throw new Error("msg param must be a string or an object");case 12:if(!this.uuid){e.next=23;break}return e.next=15,t.SEA.encrypt(JSON.stringify(n),this.getMyGroupSecret());case 15:return r=e.sent,e.next=18,this.getMySecretUuid();case 18:a=e.sent,K().get("chats").get(a).get("msgs").get(""+n.time).put(r),K().get("chats").get(a).get("latestMsg").put(r),e.next=42;break;case 23:s=this.getCurrentParticipants(),o=0;case 25:if(!(o<s.length)){e.next=42;break}return e.t0=t.SEA,e.t1=JSON.stringify(n),e.next=30,this.getSecret(s[o]);case 30:return e.t2=e.sent,e.next=33,e.t0.encrypt.call(e.t0,e.t1,e.t2);case 33:return c=e.sent,e.next=36,this.getOurSecretChannelId(s[o]);case 36:u=e.sent,K().get("chats").get(u).get("msgs").get(""+n.time).put(c),K().get("chats").get(u).get("latestMsg").put(c);case 39:o++,e.next=25;break;case 42:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.save=function(){var e=s(i().mark((function e(){var n,r,a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.uuid){e.next=17;break}return e.next=3,this.getMySecretUuid();case 3:return n=e.sent,K().get("chats").get(n).get("msgs").get("a").put(null),this.put("participants",this.participants),e.next=8,t.SEA.secret(De.getKey().epub,De.getKey());case 8:return r=e.sent,e.t0=K().get("chats").get(n).get("pub"),e.next=12,t.SEA.encrypt({uuid:this.uuid,myGroupSecret:this.getMyGroupSecret(),participants:this.participants},r);case 12:e.t1=e.sent,e.t0.put.call(e.t0,e.t1),this.participantsChanged(),e.next=27;break;case 17:a=this.getCurrentParticipants(),s=0;case 19:if(!(s<a.length)){e.next=27;break}return e.next=22,this.getOurSecretChannelId(a[s]);case 22:o=e.sent,K().get("chats").get(o).get("msgs").get("a").put(null);case 24:s++,e.next=19;break;case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.put=function(){var e=s(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.uuid?this.putGroup:this.putDirect).call(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.putGroup=function(){var e=s(i().mark((function e(n,r){var a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("msgs"!==n){e.next=2;break}throw new Error("Sorry, you can't overwrite the msgs field which is used for .send()");case 2:return e.next=4,t.SEA.encrypt(JSON.stringify(r),this.getMyGroupSecret());case 4:return a=e.sent,e.next=7,this.getMySecretUuid();case 7:s=e.sent,K().get("chats").get(s).get(n).put(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.putDirect=function(){var e=s(i().mark((function e(n,r){var a,s,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("msgs"!==n){e.next=2;break}throw new Error("Sorry, you can't overwrite the msgs field which is used for .send()");case 2:a=this.getCurrentParticipants(),s=0;case 4:if(!(s<a.length)){e.next=20;break}return e.t0=t.SEA,e.t1=JSON.stringify(r),e.next=9,this.getSecret(a[s]);case 9:return e.t2=e.sent,e.next=12,e.t0.encrypt.call(e.t0,e.t1,e.t2);case 12:return o=e.sent,e.next=15,this.getOurSecretChannelId(a[s]);case 15:c=e.sent,K().get("chats").get(c).get(n).put(o);case 17:s++,e.next=4;break;case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.on=function(){var e=s(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.uuid?this.onGroup:this.onDirect).call(this,t,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.onDirect=function(){var e=s(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&"me"!==r&&r!==De.getKey().pub||this.onMy(t,(function(e){return n(e,De.getKey().pub)})),(!r||"me"!==r&&r!==De.getKey().pub)&&this.onTheir(t,(function(e,t,r){return n(e,r)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.onGroup=function(){var e=s(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&"me"!==r&&r!==De.getKey().pub||this.onMyGroup(t,(function(e){return n(e,De.getKey().pub)})),(!r||"me"!==r&&r!==De.getKey().pub)&&this.onTheirGroup(t,(function(e,t,r){return n(e,r)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.onMy=function(){var e=s(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.uuid?this.onMyGroup:this.onMyDirect).call(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.onMyDirect=function(){var e=s(i().mark((function e(n,r){var a,o,c,u=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=2;break}throw new Error("onMy callback must be a function, got "+typeof r);case 2:a=this.getCurrentParticipants(),o=i().mark((function e(o){var c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.getOurSecretChannelId(a[o]);case 2:return c=e.sent,j().user().get("chats").get(c).get(n).on(function(){var e=s(i().mark((function e(s){var c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.SEA,e.t1=s,e.next=4,u.getSecret(a[o]);case 4:return e.t2=e.sent,e.next=7,e.t0.decrypt.call(e.t0,e.t1,e.t2);case 7:(c=e.sent)&&r(void 0!==c.v?c.v:c,n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return","break");case 5:case"end":return e.stop()}}),e)})),c=0;case 5:if(!(c<a.length)){e.next=13;break}return e.delegateYield(o(c),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:c++,e.next=5;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.onMyGroup=function(){var e=s(i().mark((function e(n,r){var a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=2;break}throw new Error("onMy callback must be a function, got "+typeof r);case 2:return e.next=4,this.getMySecretUuid();case 4:return a=e.sent,e.next=7,this.getMyGroupSecret();case 7:o=e.sent,j().user().get("chats").get(a).get(n).on(function(){var e=s(i().mark((function e(a){var s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.SEA.decrypt(a,o);case 2:(s=e.sent)&&r(void 0!==s.v?s.v:s,n,De.getKey().pub);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.onTheir=function(){var e=s(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.uuid?this.onTheirGroup:this.onTheirDirect).call(this,t,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n._onTheirDirectFromUser=function(){var e=s(i().mark((function e(n,r,a){var o,c=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasWritePermission(a)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getTheirSecretChannelId(a);case 4:o=e.sent,j().user(a).get("chats").get(o).get(n).on(function(){var e=s(i().mark((function e(s){var o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.hasWritePermission(a)){e.next=2;break}return e.abrupt("return");case 2:return e.t0=t.SEA,e.t1=s,e.next=6,c.getSecret(a);case 6:return e.t2=e.sent,e.next=9,e.t0.decrypt.call(e.t0,e.t1,e.t2);case 9:(o=e.sent)&&r(void 0!==o.v?o.v:o,n,a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.onTheirDirect=function(){var e=s(i().mark((function e(t,n,r){var a=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof n){e.next=2;break}throw new Error("onTheir callback must be a function, got "+typeof n);case 2:Object.prototype.hasOwnProperty.call(this.directSubscriptions,t)||(this.directSubscriptions[t]=[]),this.directSubscriptions[t].push({key:t,callback:n,from:r}),this.getCurrentParticipants().forEach(function(){var e=s(i().mark((function e(s){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||s===r){e.next=2;break}return e.abrupt("return");case 2:a._onTheirDirectFromUser(s,t,n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.hasWritePermission=function(e){return!this.uuid||this.participants&&this.participants[e]&&this.participants[e].write},n._onTheirGroupFromUser=function(){var e=s(i().mark((function e(n,r,a,o){var c,u=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasWritePermission(n)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getTheirSecretUuid(n);case 4:c=e.sent,j().user(n).get("chats").get(c).get(r).on(function(){var e=s(i().mark((function e(s,c,l,p){var h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&(o.event=p),u.hasWritePermission(n)){e.next=3;break}return e.abrupt("return");case 3:return e.t0=t.SEA,e.t1=s,e.next=7,u.getTheirGroupSecret(n);case 7:return e.t2=e.sent,e.next=10,e.t0.decrypt.call(e.t0,e.t1,e.t2);case 10:(h=e.sent)&&a(void 0!==h.v?h.v:h,r,n);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.onTheirGroup=function(){var e=s(i().mark((function e(t,n,r){var a,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof n){e.next=2;break}throw new Error("onTheir callback must be a function, got "+typeof n);case 2:Object.prototype.hasOwnProperty.call(this.groupSubscriptions,t)||(this.groupSubscriptions[t]=[]),this.groupSubscriptions[t].push(a={key:t,callback:n,from:r}),this.getParticipants((function(e){Object.keys(e).forEach(function(){var c=s(i().mark((function s(c){return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!r||c===r){i.next=2;break}return i.abrupt("return");case 2:if(e[c]&&e[c].write){i.next=4;break}return i.abrupt("return");case 4:o._onTheirGroupFromUser(c,t,n,a);case 5:case"end":return i.stop()}}),s)})));return function(e){return c.apply(this,arguments)}}())}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.setTyping=function(e,t){var n=this;void 0===t&&(t=5),t*=1e3,this.put("typing",(e=void 0===e||e)?(new Date).toISOString():new Date(0).toISOString()),clearTimeout(this.setTypingTimeout),this.setTypingTimeout=setTimeout((function(){return n.put("typing",!1)}),t)},n.getTyping=function(e,t){var n=this;void 0===t&&(t=5),t*=1e3,this.onTheir("typing",(function(r,i,a){if(e){var s=r&&new Date-new Date(r)<=t;e(s,a),n.getTypingTimeouts=n.getTypingTimeouts||{},clearTimeout(n.getTypingTimeouts[a]),s&&(n.getTypingTimeouts[a]=setTimeout((function(){return e(!1,a)}),t))}}))},e.addChatButton=function(t){if(void 0===t&&(t={}),!(t=Object.assign({label:"Chat"},t)).channelOptions)throw new Error("addChatButton missing options.channelOptions param");var n,r;S.injectCss();var i=S.createElement("div","iris-chat-open-button",document.body);i.setAttribute("id","iris-chat-open-button"),i.innerHTML='<svg style="margin-right:7px;margin-bottom: -0.2em" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 510 510" xml:space="preserve"><path fill="currentColor" d="M459,0H51C22.95,0,0,22.95,0,51v459l102-102h357c28.05,0,51-22.95,51-51V51C510,22.95,487.05,0,459,0z M102,178.5h306v51 H102V178.5z M306,306H102v-51h204V306z M408,153H102v-51h306V153z"></path></svg> '+t.label,i.addEventListener("click",(function(){i.setAttribute("style","display: none"),n?r.setAttribute("style",""):(n=new e(t.channelOptions),r=n.getChatBox(),document.body.appendChild(r))}))},n.getSimpleLink=function(e){return void 0===e&&(e="https://iris.to/"),this.uuid?e+"?channelId="+this.uuid+"&inviter="+De.getKey().pub:e+"?chatWith="+this.getCurrentParticipants()[0]},n.getChatLinks=function(){var n=s(i().mark((function n(r){var a,o,c,u,l,p,h=this;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===r&&(r={}),o=(a=r).callback,u=a.subscribe,c=(c=a.urlRoot)||"https://iris.to/",this.uuid){n.next=5;break}throw new Error("Only group channels may have chat links");case 5:l=[],p={},this.on("chatLinks",(function(n,r){n&&"object"==typeof n&&Object.keys(n).forEach((function(a){var f=n[a];if(null===f)return p[a]&&p[a].off(),delete p[a],void(o&&o({id:a,url:null}));if(-1===l.indexOf(a)){var d=[];l.push(a);var g=e.formatChatLink({urlRoot:c,inviter:r,channelId:h.uuid,sharedSecret:f.sharedSecret,linkId:a});o&&o({url:g,id:a}),u&&j().user(f.sharedKey.pub).get("chatRequests").map().on(function(){var e=s(i().mark((function e(n,r,s,o){var c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&"string"==typeof n&&!(n.length<10)){e.next=2;break}return e.abrupt("return");case 2:if(p[a]=o,c=JSON.stringify(n),-1!==d.indexOf(c)){e.next=10;break}return d.push(c),e.next=8,t.SEA.decrypt(n,f.sharedSecret);case 8:h.addParticipant(e.sent,void 0,void 0,!0);case 10:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}())}}))}));case 8:case"end":return n.stop()}}),n,this)})));return function(e){return n.apply(this,arguments)}}(),n.createChatLink=function(){var n=s(i().mark((function n(r){var a,s,o,c,u,l,p;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===r&&(r="https://iris.to/"),n.next=3,t.SEA.pair();case 3:return a=n.sent,s=JSON.stringify(a),n.next=7,t.SEA.secret(a.epub,a);case 7:return o=n.sent,n.next=10,t.SEA.encrypt(s,o);case 10:return c=n.sent,n.next=13,t.SEA.secret(De.getKey().epub,De.getKey());case 13:return u=n.sent,n.next=16,t.SEA.encrypt(s,u);case 16:return l=n.sent,n.next=19,S.getHash(c);case 19:return p=(p=n.sent).slice(0,12),n.next=23,S.gunAsAnotherUser(j(),a,(function(e){return e.get("chatRequests").put({a:1}).then()}));case 23:return this.chatLinks[p]={sharedKey:a,sharedSecret:o},this.put("chatLinks",this.chatLinks),K().get("chatLinks").get(p).put({encryptedSharedKey:c,ownerEncryptedSharedKey:l}),n.abrupt("return",e.formatChatLink({urlRoot:r,channelId:this.uuid,inviter:De.getKey().pub,sharedSecret:o,linkId:p}));case 27:case"end":return n.stop()}}),n,this)})));return function(e){return n.apply(this,arguments)}}(),n.getChatBox=function(){var t=this;S.injectCss();var n=!1,r=S.createElement("div","iris-chat-box"),i=S.createElement("div","iris-chat-header",r),a=S.createElement("span","iris-chat-minimize",i);a.innerText="",a.addEventListener("click",(function(e){e.stopPropagation(),r.setAttribute("class","iris-chat-box minimized"),n=!0}));var s=S.createElement("div","iris-chat-header-text",i),o=S.createElement("span","iris-online-indicator",s);o.innerHTML="&#x25cf;";var c=S.createElement("span",void 0,s),u=S.createElement("span","iris-chat-close",i);u.innerHTML="&#215;",u.addEventListener("click",(function(){r.setAttribute("style","display: none");var e=document.getElementById("iris-chat-open-button");e&&e.setAttribute("style","")})),i.addEventListener("click",(function(){n&&(r.setAttribute("class","iris-chat-box"),n=!1)}));var l=S.createElement("div","iris-chat-messages",r),p=S.createElement("div","iris-typing-indicator",r);p.innerText="typing...",this.getTyping((function(e){p.setAttribute("class","iris-typing-indicator"+(e?" yes":""))}));var h=S.createElement("div","iris-chat-input-wrapper",r),f=S.createElement("textarea",void 0,h);if(f.setAttribute("rows","1"),f.setAttribute("placeholder","Type a message"),S.isMobile){var d=S.createElement("button",void 0,h);d.innerHTML='\n        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 486.736 486.736" style="enable-background:new 0 0 486.736 486.736;" xml:space="preserve" width="100px" height="100px" fill="#000000" stroke="#000000" stroke-width="0"><path fill="currentColor" d="M481.883,61.238l-474.3,171.4c-8.8,3.2-10.3,15-2.6,20.2l70.9,48.4l321.8-169.7l-272.4,203.4v82.4c0,5.6,6.3,9,11,5.9 l60-39.8l59.1,40.3c5.4,3.7,12.8,2.1,16.3-3.5l214.5-353.7C487.983,63.638,485.083,60.038,481.883,61.238z"></path></svg>\n      ',d.addEventListener("click",(function(){t.send(f.value),f.value="",t.setTyping(!1)}))}var g=this.getCurrentParticipants();if(g.length){var m=g[0];j().user(m).get("profile").get("name").on((function(e){return c.innerText=e})),e.getActivity(j(),m,(function(e){o.setAttribute("class","iris-online-indicator"+(e.isActive?" yes":"")),l.querySelectorAll(".iris-chat-message:not(.delivered)").forEach((function(t){if(t.getAttribute("data-time")<=e.lastActive){var n=t.getAttribute("class");t.setAttribute("class",n+" delivered")}}))}))}return this.getTheirMsgsLastSeenTime((function(e){l.querySelectorAll(".iris-seen:not(.yes)").forEach((function(t){var n=t.parentElement.parentElement.parentElement;if(n.getAttribute("data-time")<=e){var r=n.getAttribute("class");-1===r.indexOf("delivered")&&n.setAttribute("class",r+" delivered"),t.setAttribute("class","iris-seen yes")}}))})),this.getMessages((function(e,n){var r=S.createElement("div","iris-msg-content");r.innerText=e.text;var i=S.createElement("div","time",r);i.innerText=S.formatTime(new Date(e.time)),n.selfAuthored&&(S.createElement("span",t.theirMsgsLastSeenTime>=e.time?"iris-seen yes":"iris-seen",i).innerHTML=' <svg version="1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 42"><polygon fill="currentColor" points="40.6,12.1 17,35.7 7.4,26.1 4.6,29 17,41.3 43.4,14.9"></polygon><polygon class="iris-delivered-checkmark" fill="currentColor" points="55.6,12.1 32,35.7 29.4,33.1 26.6,36 32,41.3 58.4,14.9"></polygon></svg>'),r.innerHTML=r.innerHTML.replace(/\n/g,"<br>\n");var a=S.createElement("div",(n.selfAuthored?"our":"their")+" iris-chat-message");a.appendChild(r),a.setAttribute("data-time",e.time);for(var s=l.children.length;s>=0;s--)if(0===s)l.insertBefore(a,l.firstChild);else{var o=l.children[s-1].getAttribute("data-time");if(o&&o<e.time){l.children[s-1].insertAdjacentElement("afterend",a);break}}l.scrollTop=l.scrollHeight})),f.addEventListener("keyup",(function(n){if(e.setActivity(j(),!0),t.setMyMsgsLastSeenTime(),13===n.keyCode){n.preventDefault();var r=f.value,i=S.getCaret(f);n.shiftKey?f.value=r.substring(0,i-1)+"\n"+r.substring(i,r.length):(f.value=r.substring(0,i-1)+r.substring(i,r.length),t.send(f.value),f.value="",t.setTyping(!1))}else t.setTyping(!!f.value.length)})),r},e.setActivity=function(e){if(j().irisActivityStatus!==e){j().irisActivityStatus=e,clearTimeout(j().setActivityTimeout);var n=function(){j().user().get("activity").put({status:e,time:new Date(t.state()).toISOString()})};n(),e&&function e(){n(),j().setActivityTimeout=setTimeout(e,3e3)}()}},e.getActivity=function(e,n){var r;j().user(e).get("activity").on((function(e){if(e&&e.time&&e.status){clearTimeout(r);var i=new Date(t.state()),a=new Date(e.time),s=a>new Date(i.getTime()-1e4)&&a<new Date(i.getTime()+3e4);n({isActive:s,lastActive:e.time,status:e.status}),s&&(r=setTimeout((function(){return n({isOnline:!1,lastActive:e.time})}),1e4))}}))},e.formatChatLink=function(e){var t=e.urlRoot,n=e.chatWith,r=e.channelId,i=e.inviter,a=e.sharedSecret,s=e.linkId,o=encodeURIComponent;return r&&i?t+"?channelId="+o(r)+"&inviter="+o(i)+"&s="+o(a)+"&k="+o(s):t+"?chatWith="+o(n)+"&s="+o(a)+"&k="+o(s)},e.createChatLink=function(){var n=s(i().mark((function n(r){var a,s,o,c,u,l,p,h,f;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===r&&(r="https://iris.to/"),a=j().user(),s=De.getKey(),n.next=5,t.SEA.pair();case 5:return o=n.sent,c=JSON.stringify(o),n.next=9,t.SEA.secret(o.epub,o);case 9:return u=n.sent,n.next=12,t.SEA.encrypt(c,u);case 12:return l=n.sent,n.next=15,t.SEA.secret(s.epub,s);case 15:return p=n.sent,n.next=18,t.SEA.encrypt(c,p);case 18:return h=n.sent,n.next=21,S.getHash(l);case 21:return f=(f=n.sent).slice(0,12),S.gunAsAnotherUser(j(),o,(function(e){e.get("chatRequests").put({a:1})})),a.get("chatLinks").get(f).put({encryptedSharedKey:l,ownerEncryptedSharedKey:h}),n.abrupt("return",e.formatChatLink({urlRoot:r,chatWith:s.pub,sharedSecret:u,linkId:f}));case 26:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.getMyChatLinks=function(){var n=s(i().mark((function n(r,a,o){var c,u,l,p;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===r&&(r="https://iris.to/"),void 0===o&&(o=!1),c=De.getKey(),u=j().user(),n.next=6,t.SEA.secret(c.epub,c);case 6:l=n.sent,p=[],u.get("chatLinks").map().on((function(n,h){if(n&&-1===p.indexOf(h)){var f=[];u.get("chatLinks").get(h).get("ownerEncryptedSharedKey").on(function(){var n=s(i().mark((function n(u){var d,g,m;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(u&&-1===p.indexOf(h)){n.next=2;break}return n.abrupt("return");case 2:return p.push(h),n.next=5,t.SEA.decrypt(u,l);case 5:return d=n.sent,n.next=8,t.SEA.secret(d.epub,d);case 8:m=e.formatChatLink({urlRoot:r,chatWith:c.pub,sharedSecret:g=n.sent,linkId:h}),a&&a({url:m,id:h}),o&&j().user(d.pub).get("chatRequests").map().on(function(){var n=s(i().mark((function n(r,a){var s;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return");case 2:if(s=JSON.stringify(r),-1!==f.indexOf(s)){n.next=10;break}return f.push(s),n.next=7,t.SEA.decrypt(r,g);case 7:new e({key:c,participants:n.sent}).save();case 10:S.gunAsAnotherUser(j(),d,(function(e){e.get("chatRequests").get(a).put(null)}));case 11:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}());case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}));case 9:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}(),n.removeGroupChatLink=function(e){this.chatLinks[e]=null,this.put("chatLinks",this.chatLinks),j().user().get("chatLinks").get(e).put(null)},e.removePrivateChatLink=function(e,t){j().user().auth(e),j().user().get("chatLinks").get(t).put(null)},e.deleteChannel=function(){var t=s(i().mark((function t(n,r){var a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j().user().auth(n),t.next=3,e.getOurSecretChannelId(r,n);case 3:a=t.sent,j().user().get("channels").get(a).put(null),j().user().get("channels").get(a).off();case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.deleteGroup=function(){var e=s(i().mark((function e(n,r){var a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.SEA.secret(n.epub,n);case 2:return a=e.sent,e.next=5,S.getHash(a);case 5:return s=e.sent,e.next=8,S.getHash(s+r);case 8:o=e.sent,j().user().auth(n),j().user().get("channels").get(o).put(null),j().user().get("channels").get(o).off();case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e}(),U=new Map;function R(e,t){void 0===e&&(e=De.getKey());var n=U.get(e);return n||(n=new N({participants:e,chatLink:t}),U.set(e,n)),n}var G=new Set;n.config({driver:[n.LOCALSTORAGE,n.INDEXEDDB,n.WEBSQL]});var q,F=function(){function e(e,t){var r=this;void 0===e&&(e=""),void 0===t&&(t=null),this.children=new Map,this.on_subscriptions=new Map,this.map_subscriptions=new Map,this.value=void 0,this.counter=0,this.loaded=!1,this.saveLocalForage=d(s(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.loaded){e.next=3;break}return e.next=3,r.loadLocalForage();case 3:r.children.size?(t=Array.from(r.children.keys()),n.setItem(r.id,t)):void 0===r.value?n.removeItem(r.id):n.setItem(r.id,null===r.value?"c2fc1ad0-f76f-11ec-b939-0242ac120002":r.value);case 4:case"end":return e.stop()}}),e)}))),500),this.loadLocalForage=d(s(i().mark((function e(){var t,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!G.has(r.id)){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,n.getItem(r.id);case 4:if(null!==(t=e.sent)){e.next=10;break}t=void 0,G.add(r.id),e.next=22;break;case 10:if("c2fc1ad0-f76f-11ec-b939-0242ac120002"!==t){e.next=14;break}t=null,e.next=22;break;case 14:if(!Array.isArray(t)){e.next=21;break}return a={},e.next=18,Promise.all(t.map(function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.get(t).once();case 2:a[t]=e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:t=a,e.next=22;break;case 21:r.value=t;case 22:return r.loaded=!0,e.abrupt("return",t);case 24:case"end":return e.stop()}}),e)}))),500),this.doCallbacks=d((function(){for(var e,t=function(){var t=e.value,n=t[0],i={off:function(){return r.on_subscriptions.delete(n)}};r.once(t[1],i,!1)},n=f(r.on_subscriptions);!(e=n()).done;)t();if(r.parent){for(var i,a=function(){var e=i.value,t=e[0],n={off:function(){return r.parent.on_subscriptions.delete(t)}};r.parent.once(e[1],n,!1)},s=f(r.parent.on_subscriptions);!(i=s()).done;)a();for(var o,c=function(){var e=o.value,t=e[0],n={off:function(){return r.parent.map_subscriptions.delete(t)}};r.once(e[1],n,!1)},u=f(r.parent.map_subscriptions);!(o=u()).done;)c()}}),40),this.id=e,this.parent=t}var t=e.prototype;return t.get=function(t){var n=this.children.get(t);if(n)return n;var r=new e(this.id+"/"+t,this);return this.children.set(t,r),this.saveLocalForage(),r},t.put=function(e){var t=this;if(Array.isArray(e))throw new Error("Sorry, we don't deal with arrays");if("object"!=typeof e||null===e)this.children=new Map,this.value=e,this.doCallbacks(),this.saveLocalForage();else{for(var n in this.value=void 0,e)this.get(n).put(e[n]);setTimeout((function(){return t.doCallbacks()}),0)}},t.once=function(){var e=s(i().mark((function e(t,n,r){var a,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=!0),!this.children.size){e.next=7;break}return a={},e.next=5,Promise.all(Array.from(this.children.keys()).map(function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.get(t).once(void 0,n);case 2:a[t]=e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:e.next=14;break;case 7:if(void 0===this.value){e.next=11;break}a=this.value,e.next=14;break;case 11:return e.next=13,this.loadLocalForage();case 13:a=e.sent;case 14:if(void 0===a&&!r){e.next=17;break}return t&&t(a,this.id.slice(this.id.lastIndexOf("/")+1),null,n),e.abrupt("return",a);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.on=function(e){var t=this,n=this.counter++;this.on_subscriptions.set(n,e),this.once(e,{off:function(){return t.on_subscriptions.delete(n)}},!1)},t.map=function(){var e=s(i().mark((function e(t){var n,r,a,s,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.counter++,this.map_subscriptions.set(n,t),r={off:function(){return o.map_subscriptions.delete(n)}},this.loaded){e.next=6;break}return e.next=6,this.loadLocalForage();case 6:for(a=f(this.children.values());!(s=a()).done;)s.value.once(t,r,!1);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e}();function H(){return q||(q=new F),q}var W={};function J(){return W||(W={},H().get("block").map((function(e,t){e!==W[t]&&(e?(W[t]=e,H().get("groups").map((function(e,n){H().get("groups").get(n).get(t).put(!1)}))):delete W[t])}))),W}var B=0,V=new Map,$=new Map;function Q(e){return void 0===e&&(e="everyone"),{get:function(t,n){var r=H().get("groups").get(e),i={};requestAnimationFrame((function(){r.map((function(e,r){if(!J()[r]&&(!i[r]||i[r]!==e)&&(i[r]=e,e)){var a=K(r);t&&"/"!==t&&(a=t.split("/").reduce((function(e,t){return e.get(decodeURIComponent(t))}),a)),n(a,r)}}))}))},_cached_map:function(e,t,n,r,i){if(e)for(var a,s=f(e.values());!(a=s()).done;){var o=a.value;i(o.value,o.key,0,r,o.from)}else{var c=new Map;V.set(t,c),this.get(n,(function(e,n){return e.map((function(e,i,a){c.set(i,{value:e,key:i,from:n});for(var s,o=f($.get(t).values());!(s=o()).done;)(0,s.value)(e,i,a,r,n)}))}))}},_cached_on:function(e,t,n,r,i){if(e)for(var a,s=f(e.values());!(a=s()).done;){var o=a.value;i(o.value,o.key,0,r,o.from)}else{var c=new Map;V.set(t,c),this.get(n,(function(e,n){return e.on((function(e,i,a){c.set(n,{value:e,key:i,from:n});for(var s,o=f($.get(t).values());!(s=o()).done;)(0,s.value)(e,i,a,r,n)}))}))}},_cached_count:function(e,t,n,r,i){if(e)i(e.size,n.split("/").pop(),null,r);else{var a=new Map;V.set(t,a),this.get(n,(function(e,n){return e.on((function(e,i){e?a.set(n,!0):a.delete(n);for(var s,o=a.size,c=f($.get(t).values());!(s=c()).done;)(0,s.value)(o,i,null,r,n)}))}))}},_cached_fn:function(t,n,r){var i=t+":"+e+":"+n,a=B++;$.has(i)?$.get(i).set(a,r):$.set(i,new Map([[a,r]]));var s={off:function(){var e=$.get(i);e&&e.delete(a)}},o=V.get(i);switch(t){case"map":this._cached_map(o,i,n,s,r);break;case"on":this._cached_on(o,i,n,s,r);break;case"count":this._cached_count(o,i,n,s,r)}},map:function(e,t){this._cached_fn("map",e,t)},on:function(e,t){this._cached_fn("on",e,t)},count:function(e,t){this._cached_fn("count",e,t)}}}var Y,Z=0,X=0,ee={};function te(){return window.Notification&&"granted"===Notification.permission}var ne="BMqSvZArOIdn7vGkYplSpkZ70-Qt8nhYbey26WVa3LF3SwzblSzm3n3HHycpNkAKVq7MCkrzFuTFs_en7Y_J2MI";function re(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}function ie(e){return ae.apply(this,arguments)}function ae(){return(ae=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:re(ne)});case 3:ce(e.sent),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("web push subscription error",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function se(){return(se=s(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("subscribing to web push",navigator.serviceWorker),te()&&navigator.serviceWorker){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,navigator.serviceWorker.ready;case 5:return e.next=7,navigator.serviceWorker.getRegistration();case 7:return(t=e.sent).active.postMessage({key:De.getKey()}),e.next=11,t.pushManager.getSubscription();case 11:(n=e.sent)?ce(n):ie(t);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=g((function(){var e=Object.values(ee);De.channelIds.forEach((function(t){R(t).put("webPushSubscriptions",e)}))}),5e3);function ce(e,t){return ue.apply(this,arguments)}function ue(){return(ue=s(i().mark((function e(n,r){var a,s,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=!0),a=De.getKey(),e.next=4,t.SEA.secret(a.epub,a);case 4:return s=e.sent,e.next=7,t.SEA.encrypt(n,s);case 7:return o=e.sent,e.next=10,S.getHash(JSON.stringify(n));case 10:c=e.sent,r&&j().user().get("webPushSubscriptions").get(c).put(o),ee[c]=n,oe();case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(){return(le=s(i().mark((function e(){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=De.getKey(),e.next=3,t.SEA.secret(n.epub,n);case 3:r=e.sent,j().user().get("webPushSubscriptions").map().on(function(){var e=s(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.SEA.decrypt(n,r);case 4:ce(e.sent,!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){return new Promise((function(t){j().user(e).get("epub").on(function(){var e=s(i().mark((function e(n,r,a,s){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&(s.off(),t(n));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}())}))}function he(e){return fe.apply(this,arguments)}function fe(){return(fe=s(i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j().user(t.from).get("profile").once();case 2:return r=(n=e.sent)&&n.name||"someone",e.abrupt("return","like"===(a=t.event||t.action)?r+" liked your post":"reply"===a?r+" replied to your post":"mention"===a?r+" mentioned you in their post":"follow"===a?r+" started following you":r+" sent you a notification: "+a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e){e?(X+=e,X=Math.max(X,0)):(X=0,j().user().get("notificationsSeenTime").put((new Date).toISOString())),H().get("unseenNotificationCount").put(X)}function ge(){return(ge=s(i().mark((function e(n,r){var a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&r){e.next=2;break}return e.abrupt("return");case 2:return"object"==typeof r&&(r.time=(new Date).toISOString()),e.next=5,pe(n);case 5:return a=e.sent,e.next=8,t.SEA.secret(a,De.getKey());case 8:return s=e.sent,e.next=11,t.SEA.encrypt(r,s);case 11:o=e.sent,j().user().get("notifications").get(n).put(o);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(){return(me=s(i().mark((function e(n,r){var a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("sending web push notification to",n,r),a=R(n),s=De.getKey(),n!==s.pub&&a.activity&&a.activity.isActive||!a.webPushSubscriptions){e.next=9;break}return e.delegateYield(i().mark((function e(){var n,o,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],o=Object.keys(a.webPushSubscriptions),c=i().mark((function e(c){var u,l,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=o[c],e.next=3,a.getSecret(u);case 3:return l=e.sent,e.next=6,t.SEA.encrypt(r.title,l);case 6:return e.t0=e.sent,e.next=9,t.SEA.encrypt(r.body,l);case 9:e.t1=e.sent,e.t2={pub:s.pub,epub:s.epub},p={title:e.t0,body:e.t1,from:e.t2},a.webPushSubscriptions[u].forEach((function(e){e&&e.endpoint&&n.push({subscription:e,payload:p})}));case 13:case"end":return e.stop()}}),e)})),u=0;case 4:if(!(u<o.length)){e.next=9;break}return e.delegateYield(c(u),"t0",6);case 6:u++,e.next=4;break;case 9:if(0!==n.length){e.next=11;break}return e.abrupt("return",{v:void 0});case 11:fetch("https://iris-notifications.herokuapp.com/notify",{method:"POST",body:JSON.stringify({subscriptions:n}),headers:{"content-type":"application/json"}}).catch((function(){}));case 12:case"end":return e.stop()}}),e)}))(),"t0",6);case 6:if("object"!=typeof(o=e.t0)){e.next=9;break}return e.abrupt("return",o.v);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ve,ye,be,we,xe,ke,Se,Ae,Ee,Te,Oe={init:function(){Y=new Date,Z=0},notifyMsg:function(e,t,n,r){function i(){if(e.timeObj<Y)return!1;if(t.selfAuthored)return!1;if("visible"===document.visibilityState)return!1;var r=R(n);return"nothing"!==r.notificationSetting&&!("mentions"===r.notificationSetting&&!e.text.includes(De.getMyName()))}if(i(),te()&&i()){var a,s,o=R(n);o.uuid?(s=o.participantProfiles[t.from].name,a=name+": "+e.text):(s="Message",a=e.text),a=S.truncateString(a,50),new Notification(s,{icon:"/assets/img/icon128.png",body:a,silent:!0}).onclick=function(){de(-1),r&&r(),window.focus()}}},getNotificationText:he,sendWebPushNotification:function(e,t){return me.apply(this,arguments)},changeUnseenNotificationCount:de,subscribeToIrisNotifications:function(e){var n,r;j().user().get("notificationsSeenTime").on((function(e){n=e,console.log(e)})),j().user().get("notificationsShownTime").on((function(e){return r=e}));var a=g((function(){j().user().get("notificationsShownTime").put((new Date).toISOString())}),1e3),o=new Set;Q().on("notifications/"+De.getPubKey(),function(){var c=s(i().mark((function s(c,u,l,p,h){var f,d,g,m,v;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(f=h.slice(0,30)+c.slice(0,30),!o.has(f)){i.next=3;break}return i.abrupt("return");case 3:return o.add(f),i.next=6,pe(h);case 6:return d=i.sent,i.next=9,t.SEA.secret(d,De.getKey());case 9:return g=i.sent,i.next=12,t.SEA.decrypt(c,g);case 12:if((m=i.sent)&&"object"==typeof m){i.next=15;break}return i.abrupt("return");case 15:if(a(),m.from=h,H().get("notifications").get(m.time).put(m),(!n||n<m.time)&&de(1),r&&!(r<m.time)){i.next=26;break}return console.log("was new!"),i.next=23,he(m);case 23:v=i.sent,new Notification(v,{icon:"/assets/img/icon128.png",body:v,silent:!0}).onclick=function(){e&&e(m.target?"/post/"+m.target:"/profile/"+m.from),de(-1),window.focus()};case 26:case"end":return i.stop()}}),s)})));return function(e,t,n,r,i){return c.apply(this,arguments)}}())},sendIrisNotification:function(e,t){return ge.apply(this,arguments)},changeChatUnseenCount:function(e,t){var n=R(e);if(n){var r=H().get("channels").get(e);t?(Z+=t,n.unseen+=t):(Z-=n.unseen||0,n.unseen=0),r.get("unseen").put(n.unseen),Z=Z>=0?Z:0,H().get("unseenMsgsTotal").put(Z)}},webPushSubscriptions:ee,subscribeToWebPush:function(){return se.apply(this,arguments)},getWebPushSubscriptions:function(){return le.apply(this,arguments)},removeSubscription:function(e){delete ee[e],j().user().get("webPushSubscriptions").get(e).put(null),oe()}},Me=S.isElectron?new t({peers:["http://localhost:8768/gun"],file:"State.electron",multicast:!1,localStorage:!1}).get("state"):null,Le={},Ie=new Map,Ce="hyECQHwSo7fgr2MVfPyakvayPeixxsaAWVtZ-vbaiSc.TXIp8MnCtrnW6n2MrYquWPcc-DTmZzMBmc2yaGv9gIU",je={electron:{openAtLogin:!0,minimizeOnClose:!0},local:{enableWebtorrent:!S.isMobile,enablePublicPeerDiscovery:!0,autoplayWebtorrent:!0,maxConnectedPeers:S.isElectron?2:1}},De={init:function(e){var t=this;if(void 0===e&&(e={}),!Ee){Ee=!0;var n=localStorage.getItem("chatKeyPair");n?this.login(JSON.parse(n)):!1!==e.autologin?this.loginAsNewUser(e):this.clearIndexedDB(),setTimeout((function(){H().get("block").map((function(){t.updateSearchIndex()})),t.updateSearchIndex()})),setInterval((function(){if(t.taskQueue.length){var e=t.taskQueue.shift();e&&e()}}),10)}},DEFAULT_SETTINGS:je,DEFAULT_FOLLOW:Ce,taskQueue:[],updateSearchIndex:d((function(){var e=Object.values(v(Le,Object.keys(J())));Ae=new r(e,{keys:["name"],includeScore:!0,includeMatches:!0,threshold:.3}),H().get("searchIndexUpdated").put(!0)}),2e3),saveSearchResult:d((function(e){H().get("contacts").get(e).put({followDistance:Le[e].followDistance,followerCount:Le[e].followers.size})}),1e3),addFollow:function(e,t,n,r){Le[t]?(Le[t].followDistance>n&&(Le[t].followDistance=n),r&&Le[t].followers.add(r)):(Le[t]={key:t,followDistance:n,followers:new Set(r&&[r])},this.taskQueue.push((function(){K(t).get("profile").get("name").on((function(n){Le[t].name=n,H().get("contacts").get(t).get("name").put(n),e&&e(t,Le[t])}))}))),this.saveSearchResult(t),e&&e(t,Le[t]),this.updateSearchIndex(),this.updateNoFollows(),this.updateNoFollowers()},removeFollow:function(e,t,n){Le[e]&&(Le[e].followers.delete(n),1===t&&H().get("groups").get("follows").get(e).put(!1),this.updateNoFollows(),this.updateNoFollowers())},getExtendedFollows:function(e,t,n,r){var i=this;void 0===t&&(t=ve.pub),void 0===n&&(n=3),void 0===r&&(r=1);var a=Ie.get(t);if(!(a&&a<=r))return Ie.set(t,r),this.addFollow(e,t,r-1),K(t).get("follow").map().on((function(a,s){a?(i.addFollow(e,s,r,t),r<n&&i.taskQueue.push((function(){return i.getExtendedFollows(e,s,n,r+1)}))):i.removeFollow(s,r,t)})),Le},updateNoFollows:d((function(){var e=Object.keys(Le).length<=1;e!==ke&&(ke=e,H().get("noFollows").put(ke))}),1e3),updateNoFollowers:d((function(){var e=!(Le[ve.pub]&&Le[ve.pub].followers.size>0);e!==Se&&(Se=e,H().get("noFollowers").put(Se))}),1e3),getSearchIndex:function(){return Ae},setOurOnlineStatus:function(){var e=window.location.hash;N.setActivity(xe="active");var t=g((function(){var t=R(e&&e.replace("#/profile/","").replace("#/chat/",""));t&&!xe&&t.setMyMsgsLastSeenTime(),N.setActivity(xe="active"),clearTimeout(we),we=setTimeout((function(){return N.setActivity(xe="online")}),3e4)}),1e3);document.addEventListener("touchmove",t),document.addEventListener("mousemove",t),document.addEventListener("keypress",t),document.addEventListener("visibilitychange",(function(){if("visible"===document.visibilityState){N.setActivity(xe="active");var t=location.pathname.slice(1).replace("chat/",""),n=e&&R(t);n&&(n.setMyMsgsLastSeenTime(),Oe.changeChatUnseenCount(t,0))}else N.setActivity(xe="online")})),t(),window.addEventListener("beforeunload",(function(){N.setActivity(xe=null)}))},updateGroups:function(){var e=this;this.getExtendedFollows((function(t,n){n.followDistance<=1&&H().get("groups").get("follows").get(t).put(!0),H().get("groups").get("everyone").get(t).put(!0),t===e.getPubKey()&&e.updateNoFollowers()}))},login:function(e){var t=this,n=!!ve;ve=e,localStorage.setItem("chatKeyPair",JSON.stringify(e)),K().auth(ve),K().put({epub:ve.epub}),K().get("likes").put({a:null}),K().get("msgs").put({a:null}),K().get("replies").put({a:null}),Oe.subscribeToWebPush(),Oe.getWebPushSubscriptions(),Oe.subscribeToIrisNotifications(),N.getMyChatLinks(void 0,(function(e){H().get("chatLinks").get(e.id).put(e.url),be=e.url})),this.setOurOnlineStatus(),N.getChannels((function(e){return t.addChannel(e)})),K().get("profile").get("name").on((function(e){e&&"string"==typeof e&&(ye=e)})),Oe.init(),H().get("loggedIn").put(!0),H().get("settings").once().then((function(e){e?void 0!==e.enableWebtorrent&&void 0!==e.autoplayWebtorrent||(H().get("settings").get("enableWebtorrent").put(je.local.enableWebtorrent),H().get("settings").get("autoplayWebtorrent").put(je.local.autoplayWebtorrent)):H().get("settings").put(je.local)})),K().get("block").map().on((function(e,t){H().get("block").get(t).put(e),e&&delete Le[t]})),this.updateGroups(),n&&location.reload(),Me&&(Me.get("settings").on((function(e){H().get("settings").get("electron").put(e)})),Me.get("user").put(ve.pub)),H().get("filters").get("group").once().then((function(e){e||H().get("filters").get("group").put("follows")}))},loginAsNewUser:function(e){var n=this;void 0===e&&(e={});var r=e.name||S.generateName();return console.log("loginAsNewUser name",r),t.SEA.pair().then((function(t){n.login(t),K().get("profile").put({a:null}),K().get("profile").get("name").put(r),H().get("filters").put({a:null}),H().get("filters").get("group").put("follows"),N.createChatLink().then((function(e){return be=e})),setTimeout((function(){!1!==e.autofollow&&(console.log("autofollowing",Ce),K().get("follow").get(Ce).put(!0))}),1e3)}))},logOut:function(){var e=this;return s(i().mark((function t(){var r,a,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Me&&Me.get("user").put(null),!navigator.serviceWorker){t.next=16;break}return t.next=4,navigator.serviceWorker.getRegistration();case 4:if(!(r=t.sent)||!r.pushManager){t.next=16;break}return null==(a=r.active)||a.postMessage({key:null}),t.next=9,r.pushManager.getSubscription();case 9:if(!(s=t.sent)){t.next=16;break}return t.next=13,S.getHash(JSON.stringify(s));case 13:Oe.removeSubscription(t.sent),s.unsubscribe&&s.unsubscribe();case 16:e.clearIndexedDB(),localStorage.clear(),n.clear().then((function(){window.location.hash="",window.location.href="/",location.reload()}));case 19:case"end":return t.stop()}}),t)})))()},clearIndexedDB:function(){return new Promise((function(e){var t=window.indexedDB.deleteDatabase("local()"),n=window.indexedDB.deleteDatabase("radata"),r=!1,i=!1,a=function(){r&&i&&e(void 0)};t.onerror=n.onerror=function(e){return console.error(e)},t.onsuccess=function(){r=!0,a()},n.onsuccess=function(){i=!0,a()}}))},getMyChatLink:function(){return be||S.getProfileLink(ve.pub)},getKey:function(){return ve},getPubKey:function(){return ve&&ve.pub},getMyName:function(){return ye},myPeerUrl:function(e){return"http://"+e+":8767/gun"},shareMyPeerUrl:function(e){var t=this;return s(i().mark((function n(){var r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,H().get("settings").get("electron").get("publicIp").once();case 2:(r=n.sent)&&e.put&&e.put("my_peer",t.myPeerUrl(r));case 4:case"end":return n.stop()}}),n)})))()},newChannel:function(e,t){if(e&&!this.channelIds.has(e)){var n=R(e,t);return this.addChannel(n),n}},addChannel:function(e){var t=this;this.taskQueue.push((function(){var n=e.getId();if(!t.channelIds.has(n)){t.channelIds.add(n);var r=H().get("channels").get(n);if(r.get("latestTime").on((function(t){t&&(!e.latestTime||t>e.latestTime)&&(e.latestTime=t)})),r.get("theirMsgsLastSeenTime").on((function(t){if(t){var n=new Date(t);(!e.theirMsgsLastSeenDate||e.theirMsgsLastSeenDate<n)&&(e.theirMsgsLastSeenDate=n)}})),e.getLatestMsg&&e.getLatestMsg((function(e,r){t.processMessage(n,e,r)})),Oe.changeChatUnseenCount(n,0),e.notificationSetting="all",e.onMy("notificationSetting",(function(t){e.notificationSetting=t})),e.theirMsgsLastSeenTime="",e.getTheirMsgsLastSeenTime((function(t){e&&t&&t>=e.theirMsgsLastSeenTime&&(e.theirMsgsLastSeenTime=t,r.get("theirMsgsLastSeenTime").put(t))})),e.getMyMsgsLastSeenTime((function(t){e.myLastSeenTime=new Date(t),e.latest&&e.myLastSeenTime>=e.latest.time&&Oe.changeChatUnseenCount(n,0)})),e.isTyping=!1,e.getTyping((function(t){e.isTyping=t,H().get("channels").get(n).get("isTyping").put(t)})),e.online={},N.getActivity(n,(function(t){e&&(r.put({theirLastActiveTime:t&&t.lastActive,activity:t&&t.isActive&&t.status}),e.activity=t)})),e.uuid){var i=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;e.participantProfiles={},e.on("name",(function(t){e.name=t,Le[e.uuid]={name:t,uuid:e.uuid},H().get("channels").get(e.uuid).get("name").put(t)})),e.on("photo",(function(t){Le[e.uuid]=Le[e.uuid]||{},Le[e.uuid].photo=t,H().get("channels").get(e.uuid).get("photo").put(t)})),e.on("about",(function(t){return H().get("channels").get(e.uuid).get("about").put(t)})),e.getParticipants((function(t){if(delete t.undefined,"object"==typeof t){var n=Object.keys(t);n.forEach((function(r,a){var s=360/Math.max(n.length,2)*a;e.participantProfiles[r]={permissions:t[r],color:"hsl("+s+", 98%, "+(i?80:33)+"%)"},K(r).get("profile").get("name").on((function(t){e.participantProfiles[r].name=t}))}))}H().get("channels").get(e.uuid).get("participants").put(t)})),e.inviteLinks={},e.getChatLinks({callback:function(t){var n=t.url,r=t.id;console.log("got chat link",r,n),e.inviteLinks[r]=n,H().get("inviteLinksChanged").put(!0)}})}else H().get("groups").get("everyone").get(n).put(!0),t.addFollow(null,n,Infinity),K(n).get("profile").get("name").on((function(e){return H().get("channels").get(n).get("name").put(e)}));if(e.put){e.onTheir("webPushSubscriptions",(function(t,r,i){Array.isArray(t)&&(e.webPushSubscriptions=e.webPushSubscriptions||{},e.webPushSubscriptions[i||n]=t)}));var a=Object.values(Oe.webPushSubscriptions);setTimeout((function(){return e.put("webPushSubscriptions",a)}),5e3),t.shareMyPeerUrl(e)}e.onTheir("call",(function(e){H().get("call").put({pub:n,call:e})})),H().get("channels").get(n).put({enabled:!0})}}))},processMessage:function(e,t,n,r){var i=R(e);i.messageIds=i.messageIds||{},i.messageIds[t.time+n.from]||(i.messageIds[t.time+n.from]=!0,n&&(t=Object.assign(t,n)),t.invite?this.newChannel(t.invite.group,"https://iris.to/?channelId="+t.invite.group+"&inviter="+e):(t.selfAuthored=n.selfAuthored,H().get("channels").get(e).get("msgs").get(t.time+(t.from&&t.from.slice(0,10))).put(JSON.stringify(t)),t.timeObj=new Date(t.time),!n.selfAuthored&&t.timeObj>i.myLastSeenTime&&(window.location.hash!=="#/chat/"+e||"visible"!==document.visibilityState?Oe.changeChatUnseenCount(e,1):"active"===xe&&i.setMyMsgsLastSeenTime()),!n.selfAuthored&&t.time>i.theirMsgsLastSeenTime&&H().get("channels").get(e).get("theirMsgsLastSeenTime").put(t.time),(!i.latestTime||t.time>i.latestTime)&&H().get("channels").get(e).put({latestTime:t.time,latest:{time:t.time,text:t.text,selfAuthored:n.selfAuthored}}),Oe.notifyMsg(t,n,e,r)))},subscribeToMsgs:function(e){var t=this,n=R(e);n.subscribed||(n.subscribed=!0,n.getMessages((function(n,r){t.processMessage(e,n,r)})))},channelIds:new Set},Pe={get:function(e,t){return new Promise((function(n,r){e||r("No hash provided"),"string"!=typeof e&&r("Hash must be a string"),j().get("#").get(e).on((function(e,r,i,a){e&&(a.off(),t&&t(e),n(e))}))}))},put:function(e){return s(i().mark((function t(){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.getHash(e);case 2:return n=t.sent,j().get("#").get(n).put(e),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()}},ze=function(){function e(){}return e.getActiveKey=function(){var t=s(i().mark((function t(n,r,a){var s,o,c,u,l;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n="."),void 0===r&&(r="iris.key"),!Te){t.next=4;break}return t.abrupt("return",Te);case 4:if(!a){t.next=21;break}if(!a.existsSync(s=n+"/"+r)){t.next=11;break}o=a.readFileSync(s,"utf8"),Te=e.fromString(o),t.next=17;break;case 11:return t.next=13,e.generate();case 13:c=t.sent,a.writeFileSync(s,e.toString(Te=Te||c)),a.chmodSync(s,400);case 17:if(Te){t.next=19;break}throw new Error("loading default key failed - check "+n+"/"+r);case 19:t.next=33;break;case 21:if(!(u=window.localStorage.getItem("iris.myKey"))){t.next=26;break}Te=e.fromString(u),t.next=31;break;case 26:return t.next=28,e.generate();case 28:l=t.sent,Te=Te||l,window.localStorage.setItem("iris.myKey",e.toString(Te));case 31:if(Te){t.next=33;break}throw new Error("loading default key failed - check localStorage iris.myKey");case 33:return t.abrupt("return",Te);case 34:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),e.getDefault=function(t,n){return void 0===t&&(t="."),void 0===n&&(n="iris.key"),e.getActiveKey(t,n)},e.getActivePub=function(){var t=s(i().mark((function t(n,r){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n="."),void 0===r&&(r="iris.key"),t.next=4,e.getActiveKey(n,r);case 4:return t.abrupt("return",t.sent.pub);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.setActiveKey=function(t,n,r,i,a){if(void 0===n&&(n=!0),void 0===r&&(r="."),void 0===i&&(i="iris.key"),Te=t,n)if(S.isNode){var s=r+"/"+i;a.writeFileSync(s,e.toString(Te)),a.chmodSync(s,400)}else window.localStorage.setItem("iris.myKey",e.toString(Te))},e.toString=function(e){return JSON.stringify(e)},e.getId=function(e){if(!e||!e.pub)throw new Error("missing param");return e.pub},e.fromString=function(e){return JSON.parse(e)},e.generate=function(){return t.SEA.pair()},e.sign=function(){var e=s(i().mark((function e(n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.SEA.sign(n,r);case 2:return e.abrupt("return","a"+e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.verify=function(e,n){return t.SEA.verify(e.slice(1),n)},e}(),Ke="Invalid  message:",_e=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n),r}(p(Error)),Ne=function(){function e(e){if(this.signedData=e.signedData,this.pubKey=e.pubKey,e.sig){if("string"!=typeof e.sig)throw new _e("SignedMessage signature must be a string");this.sig=e.sig,this.getHash()}this._validate()}e._getArray=function(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],a=e[n[r]];if("string"==typeof a)t.push(new z(i,a));else for(var s=0;s<a.length;s++)t.push(new z(i,a[s]))}return t},e._getIterable=function(e){var t;return(t={})[Symbol.iterator]=i().mark((function t(){var n,r,a,s,o,c;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Object.keys(e),r=0;case 2:if(!(r<n.length)){t.next=21;break}if(a=n[r],"string"!=typeof(s=e[n[r]])){t.next=10;break}return t.next=8,new z(a,s);case 8:t.next=18;break;case 10:o=0;case 11:if(!(o<s.length)){t.next=18;break}return c=s[o],t.next=15,new z(a,c);case 15:o++,t.next=11;break;case 18:r++,t.next=2;break;case 21:case"end":return t.stop()}}),t)})),t};var t=e.prototype;return t.getAuthorIterable=function(){return e._getIterable(this.signedData.author)},t.getRecipientIterable=function(){return e._getIterable(this.signedData.recipient)},t.getAuthorArray=function(){return e._getArray(this.signedData.author)},t.getRecipientArray=function(){return this.signedData.recipient?e._getArray(this.signedData.recipient):[]},t.getSignerKeyID=function(){return this.pubKey},t._validate=function(){if(!this.signedData)throw new _e(Ke+" Missing signedData");if("object"!=typeof this.signedData)throw new _e(Ke+" signedData must be an object");var e=this.signedData;if(!e.type)throw new _e(Ke+" Missing type definition");if(!e.author)throw new _e(Ke+" Missing author");if("object"!=typeof e.author)throw new _e(Ke+" Author must be object");if(Array.isArray(e.author))throw new _e(Ke+" Author must not be an array");if(0===Object.keys(e.author).length)throw new _e(Ke+" Author empty");for(var t in this.pubKey&&(this.signerKeyHash=this.getSignerKeyID()),e.author){var n=typeof e.author[t];if("string"!==n){if(!Array.isArray(e.author[t]))throw new _e(Ke+" Author attribute must be string or array, got "+t+": "+e.author[t]);for(var r=0;r<e.author[t].length;r++){if("string"!=typeof e.author[t][r])throw new _e(Ke+" Author attribute must be string, got "+t+": ["+e.author[t][r]+"]");if(0===e.author[t][r].length)throw new _e(Ke+" author "+t+" in array["+r+"] is empty")}}if("keyID"===t){if("string"!==n)throw new _e(Ke+" Author keyID must be string, got "+n);if(this.signerKeyHash&&e.author[t]!==this.signerKeyHash)throw new _e(Ke+" If message has a keyID author, it must be signed by the same key")}}if(e.recipient){if("object"!=typeof e.recipient)throw new _e(Ke+" Recipient must be object");if(Array.isArray(e.recipient))throw new _e(Ke+" Recipient must not be an array");if(0===Object.keys(e.recipient).length)throw new _e(Ke+" Recipient empty");for(var i in e.recipient)if("string"!=typeof e.recipient[i]){if(!Array.isArray(e.recipient[i]))throw new _e(Ke+" Recipient attribute must be string or array, got "+i+": "+e.recipient[i]);for(var a=0;a<e.recipient[i].length;a++){if("string"!=typeof e.recipient[i][a])throw new _e(Ke+" Recipient attribute must be string, got "+i+": ["+e.recipient[i][a]+"]");if(0===e.recipient[i][a].length)throw new _e(Ke+" recipient "+i+" in array["+a+"] is empty")}}}if(!e.time&&!e.timestamp)throw new _e(Ke+" Missing time field");if(!Date.parse(e.time||e.timestamp))throw new _e(Ke+" Invalid time field");if("rating"===e.type){if(isNaN(e.rating))throw new _e(Ke+" Invalid rating");if(isNaN(e.maxRating))throw new _e(Ke+" Invalid maxRating");if(isNaN(e.minRating))throw new _e(Ke+" Invalid minRating");if(e.rating>e.maxRating)throw new _e(Ke+" Rating is above maxRating");if(e.rating<e.minRating)throw new _e(Ke+" Rating is below minRating");if("string"!=typeof e.context||!e.context.length)throw new _e(Ke+" Rating messages must have a context field")}if(("verification"===e.type||"unverification"===e.type)&&e.recipient.length<2)throw new _e(Ke+" At least 2 recipient attributes are needed for a connection / disconnection. Got: "+e.recipient);return!0},t.isPositive=function(){return"rating"===this.signedData.type&&this.signedData.rating>(this.signedData.maxRating+this.signedData.minRating)/2},t.isNegative=function(){return"rating"===this.signedData.type&&this.signedData.rating<(this.signedData.maxRating+this.signedData.minRating)/2},t.isNeutral=function(){return"rating"===this.signedData.type&&this.signedData.rating===(this.signedData.maxRating+this.signedData.minRating)/2},t.sign=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze.sign(this.signedData,t);case 2:return this.sig=e.sent,this.pubKey=t.pub,e.next=6,this.getHash();case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.create=function(){var t=s(i().mark((function t(n,r){var a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.author&&r&&(n.author={keyID:ze.getId(r)}),n.time=n.time||(new Date).toISOString(),a=new e({signedData:n}),!r){t.next=6;break}return t.next=6,a.sign(r);case 6:return t.abrupt("return",a);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.createVerification=function(t,n){return t.type="verification",e.create(t,n)},e.createRating=function(t,n){return t.type="rating",t.context=t.context||"iris",t.maxRating=t.maxRating||10,t.minRating=t.minRating||-10,e.create(t,n)},t.getAuthor=function(e){for(var t,n=f(this.getAuthorIterable());!(t=n()).done;){var r=t.value;if(r.isUniqueType())return e.getContacts(r)}},t.getRecipient=function(e){if(this.signedData.recipient)for(var t,n=f(this.getRecipientIterable());!(t=n()).done;){var r=t.value;if(r.isUniqueType())return e.getContacts(r)}},t.getHash=function(){var e=s(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.sig||this.hash){e.next=4;break}return e.next=3,S.getHash(this.sig);case 3:this.hash=e.sent;case 4:return e.abrupt("return",this.hash);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.getId=function(){return this.getHash()},e.fromSig=function(){var t=s(i().mark((function t(n){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.sig){t.next=2;break}throw new Error("Missing signature in object:",n);case 2:if(n.pubKey){t.next=4;break}throw new Error("Missing pubKey in object:");case 4:return r=JSON.parse(n.sig.slice(4)).m,t.abrupt("return",new e({signedData:r,sig:n.sig,pubKey:n.pubKey}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.verify=function(){var e=s(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pubKey){e.next=2;break}throw new _e(Ke+" SignedMessage has no .pubKey");case 2:if(this.sig){e.next=4;break}throw new _e(Ke+" SignedMessage has no .sig");case 4:return e.next=6,ze.verify(this.sig,this.pubKey);case 6:if(this.signedData=e.sent,this.signedData){e.next=9;break}throw new _e(Ke+" Invalid signature");case 9:if(!this.hash){e.next=18;break}return e.t0=this.hash,e.next=13,S.getHash(this.sig);case 13:if(e.t1=e.sent,e.t0===e.t1){e.next=16;break}throw new _e(Ke+" Invalid message hash");case 16:e.next=19;break;case 18:this.getHash();case 19:return e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.serialize=function(){return{sig:this.sig,pubKey:this.pubKey}},t.toString=function(){return JSON.stringify(this.serialize())},e.deserialize=function(){var t=s(i().mark((function t(n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.fromSig(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.fromString=function(){var t=s(i().mark((function t(n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.fromSig(JSON.parse(n)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.setReaction=function(){var e=s(i().mark((function e(t,n,r){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getHash();case 2:a=e.sent,t.get("reactions").get(a).put(r),t.get("reactions").get(a).put(r),t.get("messagesByHash").get(a).get("reactions").get(this.rootContact.value).put(r),t.get("messagesByHash").get(a).get("reactions").get(this.rootContact.value).put(r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),e}();exports.default={local:H,global:j,group:Q,public:K,private:R,static:Pe,electron:Me,peers:C,session:De,util:S,notifications:Oe,SEA:t.SEA,Gun:t,SignedMessage:Ne,Channel:N,Node:F};
//# sourceMappingURL=iris-lib.cjs.production.min.js.map
