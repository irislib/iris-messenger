!function(){function t(e,r){function n(t){return t.split("/").slice(-1).toString().replace(".js","")}return r?require(e):e.slice?t[n(e)]:function(r,o){e(r={exports:{}}),t[n(o)]=r.exports}}if("undefined"!=typeof module)var e=module;t((function(t){"undefined"!=typeof window&&(t.window=window);var r=(t.window||t).SEA||{};(r.window=t.window)&&(r.window.SEA=r);try{void 0!==e&&(e.exports=r)}catch(t){}t.exports=r}))(t,"./root"),t((function(){var e=t("./root");try{e.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("WebCrypto used by GUN SEA implementation does not work without HTTPS. Will automatically redirect."),location.protocol="https:")}catch(t){}}))(t,"./https"),t((function(){"undefined"==typeof btoa&&("undefined"==typeof Buffer&&(global.Buffer=require("buffer").Buffer),global.btoa=function(t){return Buffer.from(t,"binary").toString("base64")},global.atob=function(t){return Buffer.from(t,"base64").toString("binary")})}))(t,"./base64"),t((function(e){function r(){}t("./base64"),Object.assign(r,{from:Array.from}),(r.prototype=Object.create(Array.prototype)).toString=function(t,e,r){e=e||0;const n=this.length;if("hex"===(t=t||"utf8")){const t=new Uint8Array(this);return[...Array((r&&r+1||n)-e).keys()].map((r=>t[r+e].toString(16).padStart(2,"0"))).join("")}return"utf8"===t?Array.from({length:(r||n)-e},((t,r)=>String.fromCharCode(this[r+e]))).join(""):"base64"===t?btoa(this):void 0},e.exports=r}))(t,"./array"),t((function(e){function r(...t){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),r.from(...t)}t("./base64");var n=t("./array");r.prototype=Object.create(Array.prototype),Object.assign(r,{from(){if(!Object.keys(arguments).length||null==arguments[0])throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const t=arguments[0];let e;if("string"==typeof t){const r=arguments[1]||"utf8";if("hex"===r){const r=t.match(/([\da-fA-F]{2})/g).map((t=>parseInt(t,16)));if(!r||!r.length)throw new TypeError("Invalid first argument for type 'hex'.");e=n.from(r)}else if("utf8"===r){const r=t.length,o=new Uint16Array(r);Array.from({length:r},((e,r)=>o[r]=t.charCodeAt(r))),e=n.from(o)}else if("base64"===r){const r=atob(t),o=r.length,a=new Uint8Array(o);Array.from({length:o},((t,e)=>a[e]=r.charCodeAt(e))),e=n.from(a)}else"binary"===r?e=n.from(t):console.info("SafeBuffer.from unknown encoding: "+r);return e}if(t.byteLength?t.byteLength:t.length){let e;return t instanceof ArrayBuffer&&(e=new Uint8Array(t)),n.from(e||t)}},alloc:(t,e=0)=>n.from(new Uint8Array(Array.from({length:t},(()=>e)))),allocUnsafe:t=>n.from(new Uint8Array(Array.from({length:t}))),concat(t){if(!Array.isArray(t))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return n.from(t.reduce(((t,e)=>t.concat(Array.from(e))),[]))}}),r.prototype.from=r.from,r.prototype.toString=n.prototype.toString,e.exports=r}))(t,"./buffer"),t((function(e){const r=t("./root"),n=t("./buffer"),o={Buffer:n};var a={};if(r.window&&(o.crypto=window.crypto||window.msCrypto,o.subtle=(o.crypto||a).subtle||(o.crypto||a).webkitSubtle,o.TextEncoder=window.TextEncoder,o.TextDecoder=window.TextDecoder,o.random=t=>n.from(o.crypto.getRandomValues(new Uint8Array(n.alloc(t))))),!o.TextDecoder){const{TextEncoder:t,TextDecoder:e}=require("text-encoding");o.TextDecoder=e,o.TextEncoder=t}if(!o.crypto)try{var i=t("crypto",1);Object.assign(o,{crypto:i,random:t=>n.from(i.randomBytes(t))});const{Crypto:e}=t("@peculiar/webcrypto",1);o.ossl=o.subtle=new e({directory:"ossl"}).subtle}catch(t){console.log("text-encoding and @peculiar/webcrypto may not be included by default, please add it to your package.json!")}e.exports=o}))(t,"./shim"),t((function(e){var r=t("./root"),n=(t("./buffer"),{pbkdf2:{hash:{name:"SHA-256"},iter:1e5,ks:64},ecdsa:{pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},ecdh:{name:"ECDH",namedCurve:"P-256"},jwk:function(t,e){var r={kty:"EC",crv:"P-256",x:(t=t.split("."))[0],y:t[1],ext:!0};return r.key_ops=e?["sign"]:["verify"],e&&(r.d=e),r},keyToJwk:function(t){return{kty:"oct",k:t.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},recall:{validity:43200,hook:function(t){return t}},check:function(t){return"string"==typeof t&&"SEA{"===t.slice(0,4)},parse:function(t){try{var e="string"==typeof t;return e&&"SEA{"===t.slice(0,4)&&(t=t.slice(3)),e?JSON.parse(t):t}catch(t){}return t}});r.opt=n,e.exports=n}))(t,"./settings"),t((function(e){var r=t("./shim");e.exports=async function(t,e){var n="string"==typeof t?t:JSON.stringify(t),o=await r.subtle.digest({name:e||"SHA-256"},(new r.TextEncoder).encode(n));return r.Buffer.from(o)}}))(t,"./sha256"),t((function(e){const r=t("./shim"),n=r.ossl?r.ossl:r.subtle;e.exports=t=>n.digest({name:"SHA-1"},new ArrayBuffer(t))}))(t,"./sha1"),t((function(e){var r=t("./root"),n=t("./shim"),o=t("./settings"),a=t("./sha256");r.work=r.work||(async(t,e,i,s)=>{try{var c=(e||{}).epub||e;if(s=s||{},c instanceof Function&&(i=c,c=undefined),t="string"==typeof t?t:JSON.stringify(t),"sha"===(s.name||"").toLowerCase().slice(0,3)){var u=n.Buffer.from(await a(t,s.name),"binary").toString(s.encode||"base64");if(i)try{i(u)}catch(t){console.log(t)}return u}c=c||n.random(9);var f=await(n.ossl||n.subtle).importKey("raw",(new n.TextEncoder).encode(t),{name:s.name||"PBKDF2"},!1,["deriveBits"]),p=await(n.ossl||n.subtle).deriveBits({name:s.name||"PBKDF2",iterations:s.iterations||o.pbkdf2.iter,salt:(new n.TextEncoder).encode(s.salt||c),hash:s.hash||o.pbkdf2.hash},f,s.length||8*o.pbkdf2.ks);t=n.random(t.length);var l=n.Buffer.from(p,"binary").toString(s.encode||"base64");if(i)try{i(l)}catch(t){console.log(t)}return l}catch(t){if(console.log(t),r.err=t,r.throw)throw t;return void(i&&i())}}),e.exports=r.work}))(t,"./work"),t((function(e){var r=t("./root"),n=t("./shim");t("./settings");r.name=r.name||(async t=>{try{if(t)try{t()}catch(t){console.log(t)}return}catch(e){if(console.log(e),r.err=e,r.throw)throw e;return void(t&&t())}}),r.pair=r.pair||(async t=>{try{var e=n.ossl||n.subtle,o=await n.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then((async t=>{var e={};e.priv=(await n.subtle.exportKey("jwk",t.privateKey)).d;var r=await n.subtle.exportKey("jwk",t.publicKey);return e.pub=r.x+"."+r.y,e}));try{var a=await e.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then((async t=>{var r={};r.epriv=(await e.exportKey("jwk",t.privateKey)).d;var n=await e.exportKey("jwk",t.publicKey);return r.epub=n.x+"."+n.y,r}))}catch(t){if(r.window)throw t;if("Error: ECDH is not a supported algorithm"!=t)throw t;console.log("Ignoring ECDH...")}var i={pub:o.pub,priv:o.priv,epub:(a=a||{}).epub,epriv:a.epriv};if(t)try{t(i)}catch(t){console.log(t)}return i}catch(e){if(console.log(e),r.err=e,r.throw)throw e;return void(t&&t())}}),e.exports=r.pair}))(t,"./pair"),t((function(e){var r,n=t("./root"),o=t("./shim"),a=t("./settings"),i=t("./sha256");n.sign=n.sign||(async(t,e,s,c)=>{try{if(c=c||{},(e||c).priv||(e=await n.I(null,{what:t,how:"sign",why:c.why})),r===t)throw"`undefined` not allowed.";var u=a.parse(t),f=c.check=c.check||u;if(n.verify&&(n.opt.check(f)||f&&f.s&&f.m)&&r!==await n.verify(f,e)){var p=a.parse(f);if(c.raw||(p="SEA"+JSON.stringify(p)),s)try{s(p)}catch(t){console.log(t)}return p}var l=a.jwk(e.pub,e.priv),y=await i(u),h=await(o.ossl||o.subtle).importKey("jwk",l,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then((t=>(o.ossl||o.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},t,new Uint8Array(y))));p={m:u,s:o.Buffer.from(h,"binary").toString(c.encode||"base64")};if(c.raw||(p="SEA"+JSON.stringify(p)),s)try{s(p)}catch(t){console.log(t)}return p}catch(t){if(console.log(t),n.err=t,n.throw)throw t;return void(s&&s())}}),e.exports=n.sign}))(t,"./sign"),t((function(e){var r,n=t("./root"),o=t("./shim"),a=t("./settings"),i=t("./sha256");n.verify=n.verify||(async(t,e,s,c)=>{try{var u=a.parse(t);if(!1===e){var f=a.parse(u.m);if(s)try{s(f)}catch(t){console.log(t)}return f}c=c||{};var p,l,y,h=e.pub||e,g=n.opt.slow_leak?await n.opt.slow_leak(h):await(o.ossl||o.subtle).importKey("jwk",a.jwk(h),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),d=await i(u.m);try{if(p=o.Buffer.from(u.s,c.encode||"base64"),l=new Uint8Array(p),!(y=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,l,new Uint8Array(d))))throw"Signature did not match."}catch(r){if(n.opt.fallback)return await n.opt.fall_verify(t,e,s,c)}var w=y?a.parse(u.m):r;if(s)try{s(w)}catch(t){console.log(t)}return w}catch(t){if(console.log(t),n.err=t,n.throw)throw t;return void(s&&s())}}),e.exports=n.verify;var s={},c=(n.opt.slow_leak=t=>{if(s[t])return s[t];var e=a.jwk(t);return s[t]=(o.ossl||o.subtle).importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),s[t]},n.opt);n.opt.fall_verify=async function(t,e,s,u,f){if(f===n.opt.fallback)throw"Signature did not match";f=f||1;var p=t||"";t=n.opt.unpack(t)||t;var l,y,h,g=a.parse(t),d=e.pub||e,w=await n.opt.slow_leak(d),b=f<=n.opt.fallback?o.Buffer.from(await o.subtle.digest({name:"SHA-256"},(new o.TextEncoder).encode(a.parse(g.m)))):await i(g.m);try{if(l=o.Buffer.from(g.s,u.encode||"base64"),y=new Uint8Array(l),!(h=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},w,y,new Uint8Array(b))))throw"Signature did not match."}catch(t){if(l=o.Buffer.from(g.s,"utf8"),y=new Uint8Array(l),!(h=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},w,y,new Uint8Array(b))))throw"Signature did not match."}var v=h?a.parse(g.m):r;if(c.fall_soul=p["#"],c.fall_key=p["."],c.fall_val=t,c.fall_state=p[">"],s)try{s(v)}catch(t){console.log(t)}return v},n.opt.fallback=2}))(t,"./verify"),t((function(e){var r=t("./shim"),n=t("./settings"),o=t("./sha256");e.exports=async(t,e,a)=>{a=a||{};const i=t+(e||r.random(8)).toString("utf8"),s=r.Buffer.from(await o(i),"binary"),c=n.keyToJwk(s);return await r.subtle.importKey("jwk",c,{name:"AES-GCM"},!1,["encrypt","decrypt"])}}))(t,"./aeskey"),t((function(e){var r=t("./root"),n=t("./shim"),o=(t("./settings"),t("./aeskey"));r.encrypt=r.encrypt||(async(t,e,a,i)=>{try{i=i||{};var s=(e||i).epriv||e;if(undefined===t)throw"`undefined` not allowed.";s||(s=(e=await r.I(null,{what:t,how:"encrypt",why:i.why})).epriv||e);var c="string"==typeof t?t:JSON.stringify(t),u={s:n.random(9),iv:n.random(15)},f=await o(s,u.s,i).then((t=>n.subtle.encrypt({name:i.name||"AES-GCM",iv:new Uint8Array(u.iv)},t,(new n.TextEncoder).encode(c)))),p={ct:n.Buffer.from(f,"binary").toString(i.encode||"base64"),iv:u.iv.toString(i.encode||"base64"),s:u.s.toString(i.encode||"base64")};if(i.raw||(p="SEA"+JSON.stringify(p)),a)try{a(p)}catch(t){console.log(t)}return p}catch(t){if(console.log(t),r.err=t,r.throw)throw t;return void(a&&a())}}),e.exports=r.encrypt}))(t,"./encrypt"),t((function(e){var r=t("./root"),n=t("./shim"),o=t("./settings"),a=t("./aeskey");r.decrypt=r.decrypt||(async(t,e,i,s)=>{try{s=s||{};var c=(e||s).epriv||e;c||(c=(e=await r.I(null,{what:t,how:"decrypt",why:s.why})).epriv||e);var u,f,p,l=o.parse(t);try{u=n.Buffer.from(l.s,s.encode||"base64"),f=n.Buffer.from(l.iv,s.encode||"base64"),p=n.Buffer.from(l.ct,s.encode||"base64");var y=await a(c,u,s).then((t=>n.subtle.decrypt({name:s.name||"AES-GCM",iv:new Uint8Array(f),tagLength:128},t,new Uint8Array(p))))}catch(n){if("utf8"===s.encode)throw"Could not decrypt";if(r.opt.fallback)return s.encode="utf8",await r.decrypt(t,e,i,s)}var h=o.parse(new n.TextDecoder("utf8").decode(y));if(i)try{i(h)}catch(t){console.log(t)}return h}catch(t){if(console.log(t),r.err=t,r.throw)throw t;return void(i&&i())}}),e.exports=r.decrypt}))(t,"./decrypt"),t((function(e){var r=t("./root"),n=t("./shim");t("./settings");r.secret=r.secret||(async(t,e,a,i)=>{try{i=i||{},e&&e.epriv&&e.epub||(e=await r.I(null,{what:t,how:"secret",why:i.why}));var s=e.epub,c=e.epriv,u=n.ossl||n.subtle,f=o(t.epub||t),p=Object.assign({public:await u.importKey(...f,!0,[])},{name:"ECDH",namedCurve:"P-256"}),l=o(s,c),y=await u.importKey(...l,!1,["deriveBits"]).then((async t=>{var e=await u.deriveBits(p,t,256),r=new Uint8Array(e),n=await u.importKey("raw",r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return u.exportKey("jwk",n).then((({k:t})=>t))}));if(a)try{a(y)}catch(t){console.log(t)}return y}catch(t){if(console.log(t),r.err=t,r.throw)throw t;return void(a&&a())}});var o=(t,e)=>{var[r,n]=t.split(".");return["jwk",Object.assign(e?{d:e}:{},{x:r,y:n,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};e.exports=r.secret}))(t,"./secret"),t((function(e){var r=t("./root");r.certify=r.certify||(async(t,e={},n,o,a={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),!(t=(()=>{var e=[];if(t){if(("string"==typeof t||Array.isArray(t))&&-1!==t.indexOf("*"))return"*";if("string"==typeof t)return t;if(Array.isArray(t)){if(1===t.length&&t[0])return"object"==typeof t[0]&&t[0].pub?t[0].pub:"string"==typeof t[0]?t[0]:null;t.map((t=>{"string"==typeof t?e.push(t):"object"==typeof t&&t.pub&&e.push(t.pub)}))}return"object"==typeof t&&t.pub?t.pub:e.length>0?e:null}return null})()))return console.log("No certificant found.");const s=!a.expiry||"number"!=typeof a.expiry&&"string"!=typeof a.expiry?null:parseFloat(a.expiry),c=(e||{}).read?e.read:null,u=(e||{}).write?e.write:"string"==typeof e||Array.isArray(e)||e["+"]||e["#"]||e["."]||e["="]||e["*"]||e[">"]||e["<"]?e:null,f=((a||{}).blacklist||{}).read&&("string"==typeof a.blacklist.read||a.blacklist.read["#"])?a.blacklist.read:null,p="string"==typeof(a||{}).blacklist||(((a||{}).blacklist||{}).write||{})["#"]?a.blacklist:((a||{}).blacklist||{}).write&&("string"==typeof a.blacklist.write||a.blacklist.write["#"])?a.blacklist.write:null;if(!c&&!u)return console.log("No policy found.");const l=JSON.stringify({c:t,...s?{e:s}:{},...c?{r:c}:{},...u?{w:u}:{},...f?{rb:f}:{},...p?{wb:p}:{}});var i=await r.sign(l,n,null,{raw:1});if(a.raw||(i="SEA"+JSON.stringify(i)),o)try{o(i)}catch(t){console.log(t)}return i}catch(t){if(r.err=t,r.throw)throw t;return void(o&&o())}}),e.exports=r.certify}))(t,"./certify"),t((function(e){var r=t("./shim"),n=t("./root");n.work=t("./work"),n.sign=t("./sign"),n.verify=t("./verify"),n.encrypt=t("./encrypt"),n.decrypt=t("./decrypt"),n.certify=t("./certify"),n.random=n.random||r.random,n.Buffer=n.Buffer||t("./buffer"),n.keyid=n.keyid||(async t=>{try{const e=Buffer.concat(t.replace(/-/g,"+").replace(/_/g,"/").split(".").map((t=>Buffer.from(t,"base64")))),r=Buffer.concat([Buffer.from([153,e.length/256,e.length%256]),e]),n=await sha1hash(r),o=Buffer.from(n,"binary");return o.toString("hex",o.length-8)}catch(t){throw console.log(t),t}}),e.exports=n}))(t,"./sea"),t((function(){t("./sea").Gun.chain.then=function(t,e){var r=this,n=new Promise((function(t){r.once(t,e)}));return t?n.then(t):n}}))(t,"./then"),t((function(e){function r(){this._={$:this}}var n=t("./sea").Gun;t("./then");(r.prototype=function(){function t(){}return t.prototype=n.chain,new t}()).constructor=r,n.chain.user=function(t){var e,o=this.back(-1);if(t)return o.get("~"+t);if(e=o.back("user"))return e;var a=o=o._,i=a.opt.uuid||n.state.lex;return(a=(e=a.user=this.chain(new r))._).opt={},a.opt.uuid=function(t){var e=i(),r=o.user;return r&&(r=r.is)&&(r=r.pub)?(e=e+"~"+r+"/",t&&t.call&&t(null,e),e):e},e},n.User=r,e.exports=r}))(t,"./user"),t((function(e){var r=t("./sea"),n=t("./user"),o=(t("./settings"),r.Gun),a=function(){};n.prototype.create=function(...t){const e="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,n=e&&(e.pub||e.epub)?e.pub:"string"==typeof t[0]?t[0]:null,i=e&&(e.pub||e.epub)?e:n&&"string"==typeof t[1]?t[1]:null,s=t.filter((t=>"function"==typeof t))[0]||null,c=t&&t.length>1&&"object"==typeof t[t.length-1]?t[t.length-1]:{};var u=this,f=u._,p=u.back(-1);if(f.ing)return(s||a)({err:o.log("User is already being created or authenticated!"),wait:!0}),u;f.ing=!0;var l={};return l.a=function(t){if(l.pubs=t,t&&!c.already){var e={err:o.log("User already created!")};return f.ing=!1,(s||a)(e),void u.leave()}l.salt=o.text.random(64),r.work(i,l.salt,l.b)},l.b=function(t){l.proof=t,e?l.c(e):r.pair(l.c)},l.c=function(t){var e;l.pair=t||{},(e=f.root.user)&&(e._.sea=t,e.is={pub:t.pub,epub:t.epub,alias:n}),l.data={pub:t.pub},l.d()},l.d=function(){l.data.alias=n,l.e()},l.e=function(){l.data.epub=l.pair.epub,r.encrypt({priv:l.pair.priv,epriv:l.pair.epriv},l.proof,l.f,{raw:1})},l.f=function(t){l.data.auth=JSON.stringify({ek:t,s:l.salt}),l.g(l.data.auth)},l.g=function(t){var e;l.data.auth=l.data.auth||t,p.get(e="~"+l.pair.pub).put(l.data),p.get("~@"+n).put(o.obj.put({},e,o.val.link.ify(e)),l.h)},l.h=function(){f.ing=!1,(s||a)({ok:0,pub:l.pair.pub}),s||(e?u.auth(e):u.auth(n,i))},p.get("~@"+n).once(l.a),u},n.prototype.auth=function(...t){const e="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,n=e||"string"!=typeof t[0]?null:t[0],i=n&&"string"==typeof t[1]?t[1]:null,s=t.filter((t=>"function"==typeof t))[0]||null,c=t&&t.length>1&&"object"==typeof t[t.length-1]?t[t.length-1]:{};var u=this,f=u._,p=u.back(-1);if(f.ing)return(s||a)({err:o.log("User is already being created or authenticated!"),wait:!0}),u;f.ing=!0;var l,y={};return y.a=function(t){if(!t)return y.b();if(!t.pub){var e=[];return o.node.is(t,(function(t){e.push(t)})),y.b(e)}if(y.name)return y.f(t);y.c((y.data=t).auth)},y.b=function(t){var e=(y.list=(y.list||[]).concat(t||[])).shift();if(l===e)return y.err(y.name?"Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.":"Wrong user or password.");p.get(e).once(y.a)},y.c=function(t){return l===t?y.b():o.text.is(t)?y.c(o.obj.ify(t)):void r.work(i,(y.auth=t).s,y.d,y.enc)},y.d=function(t){r.decrypt(y.auth.ek,t,y.e,y.enc)},y.e=function(t){if(l===t)return y.enc?(y.enc=null,y.b()):(y.enc={encode:"utf8"},y.c(y.auth));y.half=t,y.f(y.data)},y.f=function(t){if(!t||!t.pub)return y.b();var e=y.half||{};y.g({pub:t.pub,epub:t.epub,priv:e.priv,epriv:e.epriv})},y.g=function(t){y.pair=t;var e=p._.user,l=e._,h=l.opt;(l=e._=p.get("~"+t.pub)._).opt=h,e.is={pub:t.pub,epub:t.epub,alias:n||t},l.sea=y.pair,f.ing=!1;try{i&&!o.obj.has(o.obj.ify(f.root.graph["~"+t.pub].auth),":")&&(c.shuffle=c.change=i)}catch(t){}if(c.change?y.z():(s||a)(l),r.window&&(u.back("user")._.opt||c).remember)try{var g={};(g=window.sessionStorage).recall=!0,g.pair=JSON.stringify(t)}catch(t){}try{p._.on("auth",l)}catch(t){o.log("Your 'auth' callback crashed with:",t)}},y.z=function(){y.salt=o.text.random(64),r.work(c.change,y.salt,y.y)},y.y=function(t){r.encrypt({priv:y.pair.priv,epriv:y.pair.epriv},t,y.x,{raw:1})},y.x=function(t){y.w(JSON.stringify({ek:t,s:y.salt}))},y.w=function(t){if(c.shuffle){console.log("migrate core account from UTF8 & shuffle");var e=o.obj.to(y.data);o.obj.del(e,"_"),e.auth=t,p.get("~"+y.pair.pub).put(e)}p.get("~"+y.pair.pub).get("auth").put(t,s||a)},y.err=function(t){var e={err:o.log(t||"User cannot be found!")};f.ing=!1,(s||a)(e)},y.plugin=function(t){if(!(y.name=t))return y.err();var e=[t];"~"!==t[0]&&(e[1]="~"+t,e[2]="~@"+t),y.b(e)},e?y.g(e):n?p.get("~@"+n).once(y.a):n||i||r.name(y.plugin),u},n.prototype.pair=function(){console.log("user.pair() IS DEPRECATED AND WILL BE DELETED!!!");return!!this.is&&this._.sea},n.prototype.leave=function(){var t=this.back(-1)._.user;if(t&&(delete t.is,delete t._.is,delete t._.sea),r.window)try{var e={};delete(e=window.sessionStorage).recall,delete e.pair}catch(t){}return this},n.prototype.delete=async function(t,e,r){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var n=this,i=(n.back(-1),n.back("user"));try{i.auth(t,e,(function(){i.map().once((function(){this.put(null)})),i.leave(),(r||a)({ok:0})}))}catch(t){o.log("User.delete failed! Error:",t)}return n},n.prototype.recall=function(t,e){var n=this,o=n.back(-1);if((t=t||{})&&t.sessionStorage){if(r.window)try{var a;(a=window.sessionStorage)&&(o._.opt.remember=!0,(n.back("user")._.opt||t).remember=!0,(a.recall||a.pair)&&o.user().auth(JSON.parse(a.pair),e))}catch(t){}return n}return n},n.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const t=this.back(-1);try{return await authRecall(t),t._.user._}catch(t){const e="No session!";throw o.log(e),{err:e}}},n.prototype.trust=async function(t){o.is(t)&&t.get("pub").get(((t,e)=>{console.log(t,e)})),t.get("trust").get(path).put(theirPubkey)},n.prototype.grant=function(t,e){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var n=this,o=n.back(-1).user(),a=o._.sea,i="";return n.back((function(t){t.is||(i+=t.get||"")})),async function(){var n,s=await o.get("grant").get(a.pub).get(i).then();(s=await r.decrypt(s,a))||(s=r.random(16).toString(),n=await r.encrypt(s,a),o.get("grant").get(a.pub).get(i).put(n));var c=t.get("pub").then(),u=t.get("epub").then();c=await c,u=await u;var f=await r.secret(u,a);n=await r.encrypt(s,f),o.get("grant").get(c).get(i).put(n,e)}(),n},n.prototype.secret=function(t,e){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var n=this,o=n.back(-1).user(),a=o.pair(),i="";return n.back((function(t){t.is||(i+=t.get||"")})),async function(){var s,c=await o.get("trust").get(a.pub).get(i).then();(c=await r.decrypt(c,a))||(c=r.random(16).toString(),s=await r.encrypt(c,a),o.get("trust").get(a.pub).get(i).put(s)),s=await r.encrypt(t,c),n.put(s,e)}(),n},e.exports=n}))(t,"./create"),t((function(){function e(t){var n,a=this,i=a.as,s=t.put,c=s["#"],u=s["."],f=s[":"],p=s[">"],l=t["#"];if(c&&u)if((t._||"").faith&&(i.opt||"").faith&&"function"==typeof t._)r.verify(r.opt.pack(s),!1,(function(e){s["="]=r.opt.unpack(e),a.to.next(t)}));else{var y=function(t){i.on("in",{"@":l,err:t})};(t._||"").DBG&&((t._||"").DBG.c=+new Date),0<=c.indexOf("<?")&&(n=parseFloat(c.split("<?")[1]||""))&&p<o.state()-1e3*n?(n=t._)&&(n=n.lot)&&n.more--:"~@"!==c?"~@"!==c.slice(0,2)?(n=r.opt.pub(c))?e.pub(a,t,f,u,c,i,y,i.user||"",n):0<=c.indexOf("#")?e.hash(a,t,f,u,c,i,y):e.any(a,t,f,u,c,i,y,i.user||""):e.pubs(a,t,f,u,c,i,y):e.alias(a,t,f,u,c,i,y)}}var r=t("./sea"),n=t("./settings"),o=r.Gun;o.on("opt",(function(t){t.sea||(t.sea={own:{}},t.on("put",e,t)),this.to.next(t)})),e.hash=function(t,e,n,o,a,i,s){r.work(n,null,(function(r){if(r&&r===o.split("#").slice(-1)[0])return t.to.next(e);s("Data hash not same as hash!")}),{name:"SHA-256"})},e.alias=function(t,e,r,n,o,i,s){return r?"~@"+n===a(r)?t.to.next(e):void s("Alias not same!"):s("Data must exist!")},e.pubs=function(t,e,r,n,o,i,s){return r?n===a(r)?t.to.next(e):void s("Alias not same!"):s("Alias must exist!")},e.pub=function(t,e,i,s,u,f,p,l,y){var h;const g=n.parse(i)||{},d=(t,n,a)=>{if(t.m&&t.s&&n&&y)return r.verify(t,y,(t=>{if(c!==t&&c!==t.e&&e.put[">"]&&e.put[">"]>parseFloat(t.e))return p("Certificate expired.");if(c!==t&&t.c&&t.w&&(t.c===n||t.c.indexOf("*")>-1)){let e=u.indexOf("/")>-1?u.replace(u.substring(0,u.indexOf("/")+1),""):"";String.match=String.match||o.text.match;const i=Array.isArray(t.w)?t.w:"object"==typeof t.w||"string"==typeof t.w?[t.w]:[];for(const o of i)if(String.match(e,o["#"])&&String.match(s,o["."])||!o["."]&&String.match(e,o["#"])||!o["#"]&&String.match(s,o["."])||String.match(e?e+"/"+s:s,o["#"]||o)){if(o["+"]&&o["+"].indexOf("*")>-1&&e&&-1==e.indexOf(n)&&-1==s.indexOf(n))return p(`Path "${e}" or key "${s}" must contain string "${n}".`);if(t.wb&&("string"==typeof t.wb||(t.wb||{})["#"])){var r=f.$.back(-1);return"string"==typeof t.wb&&"~"!==t.wb.slice(0,1)&&(r=r.get("~"+y)),r.get(t.wb).get(n).once((e=>!e||1!==e&&!0!==e?a(t):p("Certificant blacklisted.")))}return a(t)}return p("Certificate verification fail.")}}))};if("pub"===s&&"~"+y===u)return i===y?t.to.next(e):p("Account not same!");(h=l.is)&&h.pub&&!g["*"]&&!g["+"]&&(y===h.pub||y!==h.pub&&((e._.out||{}).opt||{}).cert)?r.sign(r.opt.pack(e.put),l._.sea,(function(o){if(c===o)return p(r.err||"Signature fail.");if(e.put[":"]={":":h=r.opt.unpack(o.m),"~":o.s},e.put["="]=h,y===l.is.pub)return(h=a(i))&&((f.sea.own[h]=f.sea.own[h]||{})[y]=1),e.put[":"]=JSON.stringify(e.put[":"]),t.to.next(e);if(y!==l.is.pub&&((e._.out||{}).opt||{}).cert){const r=n.parse(e._.out.opt.cert);r&&r.m&&r.s&&d(r,l.is.pub,(()=>(e.put[":"]["+"]=r,e.put[":"]["*"]=l.is.pub,e.put[":"]=JSON.stringify(e.put[":"]),t.to.next(e))))}}),{raw:1}):r.verify(r.opt.pack(e.put),g["*"]||y,(function(n){var o;return n=r.opt.unpack(n),c===n?p("Unverified data."):((o=a(n))&&y===r.opt.pub(o)&&((f.sea.own[o]=f.sea.own[o]||{})[y]=1),g["+"]&&g["+"].m&&g["+"].s&&g["*"]?void d(g["+"],g["*"],(()=>(e.put["="]=n,t.to.next(e)))):(e.put["="]=n,t.to.next(e)))}))},e.any=function(t,e,r,n,o,a,i){if(a.opt.secure)return i("Soul missing public key at '"+n+"'.");a.on("secure",(function(e){if(this.off(),!a.opt.secure)return t.to.next(e);i("Data cannot be changed.")})).on.on("secure",e)};var a=o.val.link.is,i=/[^\w_-]/;r.opt.pub=function(t){if(t&&(t=t.split("~"))&&(t=t[1])&&(t=t.split(i).slice(0,2))&&2==t.length&&"@"!==(t[0]||"")[0])return t=t.slice(0,2).join(".")},r.opt.prep=function(t,e,n,a){return{"#":a,".":e,":":r.opt.parse(t),">":o.state.is(n,e)}},r.opt.pack=function(t,e,n,a){if(r.opt.check(t))return t;var i=o.obj.ify(t&&t[":"]||t)||"",s=i["~"];return s?{m:{"#":a||t["#"],".":e||t["."],":":i[":"],">":t[">"]||o.state.is(n,e)},s:s}:t};var s=r.opt;r.opt.unpack=function(t,e,n){var a;if(c!==t){if(t&&c!==(a=t[":"]))return a;if(e=e||s.fall_key,!n&&s.fall_val&&((n={})[e]=s.fall_val),e&&n){if(t===n[e])return t;if(!r.opt.check(n[e]))return t;var i=o.node.soul(n)||s.fall_soul,f=o.state.is(n,e)||s.fall_state;return t&&4===t.length&&i===t[0]&&e===t[1]&&u(f)===u(t[3])?t[2]:f<r.opt.shuffle_attack?t:void 0}}},r.opt.shuffle_attack=15463296e5;var c,u=Math.floor}))(t,"./index")}();